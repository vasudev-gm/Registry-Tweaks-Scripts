<?xml version="1.0" encoding="utf-8"?>
<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State">
	<!--https://schneegans.de/windows/unattend-generator/?LanguageMode=Interactive&ProcessorArchitecture=x86&ProcessorArchitecture=amd64&ProcessorArchitecture=arm64&BypassRequirementsCheck=true&BypassNetworkCheck=true&ComputerNameMode=Random&CompactOsMode=Default&TimeZoneMode=Implicit&PartitionMode=Interactive&DiskAssertionMode=Skip&WindowsEditionMode=Interactive&InstallFromMode=Automatic&PEMode=Default&UserAccountMode=InteractiveLocal&PasswordExpirationMode=Unlimited&LockoutMode=Default&HideFiles=HiddenSystem&ShowFileExtensions=true&ClassicContextMenu=true&LaunchToThisPC=true&TaskbarSearch=Icon&TaskbarIconsMode=Default&DisableWidgets=true&LeftTaskbar=true&HideTaskViewButton=true&ShowAllTrayIcons=true&DisableBingResults=true&StartTilesMode=Default&StartPinsMode=Empty&DisableFastStartup=true&DisableSystemRestore=true&EnableLongPaths=true&HardenSystemDriveAcl=true&AllowPowerShellScripts=true&DisableLastAccess=true&PreventAutomaticReboot=true&DisableAppSuggestions=true&PreventDeviceEncryption=true&HideEdgeFre=true&DisableEdgeStartupBoost=true&MakeEdgeUninstallable=true&DeleteWindowsOld=true&EffectsMode=Custom&ControlAnimations=true&DWMAeroPeekEnabled=true&MenuAnimation=true&TooltipAnimation=true&SelectionFade=true&ListviewShadow=true&ThumbnailsOrIcon=true&DragFullWindows=true&ComboBoxAnimation=true&FontSmoothing=true&ListBoxSmoothScrolling=true&DropShadow=true&DeleteEdgeDesktopIcon=true&DesktopIconsMode=Custom&IconRecycleBin=true&IconThisPC=true&StartFoldersMode=Default&WifiMode=Interactive&ExpressSettings=DisableAll&LockKeysMode=Skip&StickyKeysMode=Default&ColorMode=Default&WallpaperMode=Default&LockScreenMode=Default&Remove3DViewer=true&RemoveBingSearch=true&RemoveClipchamp=true&RemoveClock=true&RemoveCortana=true&RemoveDevHome=true&RemoveFamily=true&RemoveFeedbackHub=true&RemoveGameAssist=true&RemoveInternetExplorer=true&RemoveMailCalendar=true&RemoveMaps=true&RemoveMixedReality=true&RemoveZuneVideo=true&RemoveNews=true&RemoveOffice365=true&RemoveOneDrive=true&RemoveOneNote=true&RemoveOutlook=true&RemovePaint3D=true&RemovePeople=true&RemovePhotos=true&RemovePowerAutomate=true&RemovePowerShell2=true&RemoveSkype=true&RemoveSolitaire=true&RemoveTeams=true&RemoveToDo=true&RemoveWallet=true&RemoveWeather=true&RemoveZuneMusic=true&RemoveWordPad=true&RemoveYourPhone=true&SystemScript0=powercfg+%2FH+OFF&SystemScriptType0=Cmd&SystemScript1=Windows+Registry+Editor+Version+5.00%0D%0A%0D%0A%5BHKEY_LOCAL_MACHINE%5CSOFTWARE%5CPolicies%5CMicrosoft%5CWindows%5CCloudContent%5D%0D%0A%22DisableCloudOptimizedContent%22%3Ddword%3A00000001&SystemScriptType1=Reg&FirstLogonScript0=reg+add+%22HKLM%5CSOFTWARE%5CPolicies%5CMicrosoft%5CWindows+NT%5CSystemRestore%22+%2Fv+%22DisableConfig%22+%2Ft+%22REG_DWORD%22+%2Fd+%221%22+%2Ff%0D%0Areg+add+%22HKLM%5CSOFTWARE%5CPolicies%5CMicrosoft%5CWindows+NT%5CSystemRestore%22+%2Fv+%22DisableSR+%22+%2Ft+%22REG_DWORD%22+%2Fd+%221%22+%2Ff%0D%0Areg+add+%22HKLM%5CSOFTWARE%5CMicrosoft%5CWindows+NT%5CCurrentVersion%5CSystemRestore%22+%2Fv+%22DisableConfig%22+%2Ft+%22REG_DWORD%22+%2Fd+%221%22+%2Ff%0D%0Areg+add+%22HKLM%5CSOFTWARE%5CMicrosoft%5CWindows+NT%5CCurrentVersion%5CSystemRestore%22+%2Fv+%22DisableSR+%22+%2Ft+%22REG_DWORD%22+%2Fd+%221%22+%2Ff&FirstLogonScriptType0=Cmd&FirstLogonScript1=DISM.exe+%2FOnline+%2FSet-ReservedStorageState+%2FState%3ADisabled&FirstLogonScriptType1=Cmd&FirstLogonScript2=%40echo+off%0D%0Acls%0D%0A%0D%0Aset+x86%3D%22%25SYSTEMROOT%25%5CSystem32%5COneDriveSetup.exe%22%0D%0Aset+x64%3D%22%25SYSTEMROOT%25%5CSysWOW64%5COneDriveSetup.exe%22%0D%0A%0D%0Aecho+Closing+OneDrive+process.%0D%0Aecho.%0D%0Ataskkill+%2Ff+%2Fim+OneDrive.exe+%3E+NUL+2%3E%261%0D%0Aping+127.0.0.1+-n+5+%3E+NUL+2%3E%261%0D%0A%0D%0Aecho+Uninstalling+OneDrive.%0D%0Aecho.%0D%0Aif+exist+%25x64%25+%28%0D%0A%25x64%25+%2Funinstall%0D%0A%29+else+%28%0D%0A%25x86%25+%2Funinstall%0D%0A%29%0D%0Aping+127.0.0.1+-n+5+%3E+NUL+2%3E%261%0D%0A%0D%0Aecho+Removing+OneDrive+leftovers.%0D%0Aecho.%0D%0Ard+%22%25USERPROFILE%25%5COneDrive%22+%2FQ+%2FS+%3E+NUL+2%3E%261%0D%0Ard+%22C%3A%5COneDriveTemp%22+%2FQ+%2FS+%3E+NUL+2%3E%261%0D%0Ard+%22%25LOCALAPPDATA%25%5CMicrosoft%5COneDrive%22+%2FQ+%2FS+%3E+NUL+2%3E%261%0D%0Ard+%22%25PROGRAMDATA%25%5CMicrosoft+OneDrive%22+%2FQ+%2FS+%3E+NUL+2%3E%261+%0D%0A%0D%0Aecho+Removing+OneDrive+from+the+Explorer+Side+Panel.%0D%0Aecho.%0D%0AREG+DELETE+%22HKEY_CLASSES_ROOT%5CCLSID%5C%7B018D5C66-4533-4307-9B53-224DE2ED1FE6%7D%22+%2Ff+%3E+NUL+2%3E%261%0D%0AREG+DELETE+%22HKEY_CLASSES_ROOT%5CWow6432Node%5CCLSID%5C%7B018D5C66-4533-4307-9B53-224DE2ED1FE6%7D%22+%2Ff+%3E+NUL+2%3E%261%0D%0A%0D%0Aexit&FirstLogonScriptType2=Cmd&FirstLogonScript3=fsutil+behavior+set+disable8dot3+1&FirstLogonScriptType3=Cmd&FirstLogonScript4=%23+This+script+will+install+Winget+from+within+the+Windows+Sandbox%0D%0A%23+It+fetches+the+necessary+files+and+dependencies+from+Microsoft%27s+winget-cli%2C+and+installs+them%0D%0A%0D%0A%23+Author%3A+ThioJoe%0D%0A%23+Repo+Url%3A+https%3A%2F%2Fgithub.com%2FThioJoe%2FWindows-Sandbox-Tools%0D%0A%23+Last+Updated%3A+August+4%2C+2025%0D%0A%0D%0Aparam%28%0D%0A++++++++%5Bswitch%5D%24removeMsStoreAsSource+%3D+%24false+%23+If+switch+is+included%2C+it+will+remove+the+%27msstore%27+source+after+installing+winget%2C+which+doesn%27t+work+with+Sandbox%2C+unless+the+Microsoft+Store+is+also+installed%0D%0A++++%29%0D%0A%0D%0Afunction+Get-LatestRelease+%7B%0D%0A++++param%28%0D%0A++++++++%5Bstring%5D%24repoOwner+%3D+%27microsoft%27%2C%0D%0A++++++++%5Bstring%5D%24repoName+%3D+%27winget-cli%27%0D%0A++++%29%0D%0A++++try+%7B%0D%0A++++++++%24releasesUrl+%3D+%22https%3A%2F%2Fapi.github.com%2Frepos%2F%24repoOwner%2F%24repoName%2Freleases%22%0D%0A++++++++%24releases+%3D+Invoke-RestMethod+-Uri+%24releasesUrl+-UseBasicParsing%0D%0A++++%7D+catch+%7B%0D%0A++++++++Write-Error+%22Failed+to+fetch+releases+from+GitHub+API%3A+%24%28%24_.Exception.Message%29%22%0D%0A++++++++return+%24null%0D%0A++++%7D%0D%0A%0D%0A%09if+%28-not+%24releases%29+%7B+Write-Error+%22No+releases+found+for+%24repoOwner%2F%24repoName.%22%3B+return+%24null%3B+%7D%0D%0A%0D%0A++++%23+Pick+the+top+entry+once+sorted+by+published_at+descending%0D%0A++++%24latestRelease+%3D+%24releases+%7C+Sort-Object+-Property+published_at+-Descending+%7C+Select-Object+-First+1%0D%0A++++return+%24latestRelease%0D%0A%7D%0D%0A%0D%0Afunction+Get-AssetUrl+%7B%0D%0A++++param%28%0D%0A++++++++%5BParameter%28Mandatory%3D%24true%29%5D%0D%0A++++++++%24release%2C%0D%0A++++++++%5BParameter%28Mandatory%3D%24true%29%5D%0D%0A++++++++%5Bstring%5D%24assetName%0D%0A++++%29%0D%0A%0D%0A++++if+%28%24release.assets+-and+%24release.assets.Count+-gt+0%29+%7B%0D%0A++++++++%24asset+%3D+%24release.assets+%7C+Where-Object+%7B+%24_.name+-eq+%24assetName+%7D%0D%0A++++++++if+%28%24asset%29+%7B%0D%0A++++++++++++return+%24asset.browser_download_url%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A++++return+%24null%0D%0A%7D%0D%0A%0D%0Afunction+Install-WingetDependencies+%7B%0D%0A++++param%28%5Bstring%5D%24depsFolder%29%0D%0A%0D%0A++++%23+Look+for+DesktopAppInstaller_Dependencies.json+to+determine+explicit+install+order%0D%0A++++%24jsonFile+%3D+Join-Path+%24depsFolder+%22DesktopAppInstaller_Dependencies.json%22%0D%0A++++if+%28Test-Path+%24jsonFile%29+%7B%0D%0A++++++++Write-Host+%22Installing+dependencies+based+on+DesktopAppInstaller_Dependencies.json%22%0D%0A++++++++%24jsonContent+%3D+Get-Content+%24jsonFile+-Raw+%7C+ConvertFrom-Json%0D%0A++++++++%24dependencies+%3D+%24jsonContent.Dependencies%0D%0A%0D%0A++++++++foreach+%28%24dep+in+%24dependencies%29+%7B%0D%0A++++++++++++%23+For+example%3A+%22Microsoft.VCLibs.140.00.UWPDesktop%22+%2B+%2214.0.33728.0%22%0D%0A++++++++++++%24matchingFiles+%3D+Get-ChildItem+-Path+%24depsFolder+-Filter+*.appx+-Recurse+%7C%0D%0A++++++++++++++++Where-Object+%7B+%24_.Name+-like+%22*%24%28%24dep.Name%29*%22+-and+%24_.Name+-like+%22*%24%28%24dep.Version%29*%22+%7D%0D%0A%0D%0A++++++++++++foreach+%28%24file+in+%24matchingFiles%29+%7B%0D%0A++++++++++++++++Write-Host+%22Installing+dependency%3A+%24%28%24file.Name%29%22%0D%0A++++++++++++++++Add-AppxPackage+-Path+%24file.FullName%0D%0A++++++++++++%7D%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A++++else+%7B%0D%0A++++++++%23+If+the+JSON+doesn%27t+exist%2C+install+all+.appx+in+the+folder%0D%0A++++++++Write-Warning+%22No+DesktopAppInstaller_Dependencies.json+found%2C+installing+all+.appx+in+%24depsFolder%22%0D%0A++++++++foreach+%28%24appxFile+in+Get-ChildItem+%24depsFolder+-Filter+*.appx+-Recurse%29+%7B%0D%0A++++++++++++Write-Host+%22Installing%3A+%24%28%24appxFile.Name%29%22%0D%0A++++++++++++Add-AppxPackage+-Path+%24appxFile.FullName%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%7D%0D%0A%0D%0A%23+Prevents+progress+bar+from+showing+%28often+speeds+downloads%29%0D%0A%24ProgressPreference+%3D+%27SilentlyContinue%27%0D%0A%0D%0A%24downloadPath+%3D+Join-Path+%24env%3AUSERPROFILE+%22Downloads%22%0D%0A%24latestRelease+%3D+Get-LatestRelease%0D%0Aif+%28-not+%24latestRelease%29+%7B+Write-Error+%22Could+not+retrieve+the+latest+release.+Exiting.%22%3B+return%3B+%7D%0D%0A%0D%0A%24latestTag+%3D+%24latestRelease.tag_name%0D%0AWrite-Host+%22Latest+winget+version+tag+is%3A+%24latestTag%22%0D%0A%0D%0A%23+Download+the+MSIX+bundle%0D%0A%24msixName+%3D+%22Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle%22%0D%0A%24msixUrl+%3D+Get-AssetUrl+-release+%24latestRelease+-assetName+%24msixName%0D%0Aif+%28-not+%24msixUrl%29+%7B+Write-Error+%22Could+not+find+%24msixName+in+the+latest+release+assets.%22%3B+return%3B+%7D%0D%0A%0D%0AWrite-Host+%22Downloading+%24msixName...%22%0D%0A%24msixPath+%3D+Join-Path+%24downloadPath+%24msixName%0D%0AInvoke-WebRequest+-Uri+%24msixUrl+-OutFile+%24msixPath%0D%0A%0D%0A%23+Figure+out+the+OS+architecture+using+environment+variable%0D%0A%24procArch+%3D+%24env%3APROCESSOR_ARCHITECTURE%0D%0Aswitch+-Wildcard+%28%24procArch%29+%7B%0D%0A++++%22AMD64%22+++%7B+%24arch+%3D+%22x64%22+%7D%0D%0A++++%22x86%22+++++%7B+%24arch+%3D+%22x86%22+%7D%0D%0A++++%22*ARM64*%22+%7B+%24arch+%3D+%22arm64%22+%7D%0D%0A++++%22*ARM*%22+++%7B+%24arch+%3D+%22arm%22+%7D%0D%0A++++default+%7B%0D%0A++++++++%24arch+%3D+%22x64%22%0D%0A++++++++Write-Warning+%22Unrecognized+architecture%3A+%24procArch.+Defaulting+to+x64.%22%0D%0A++++%7D%0D%0A%7D%0D%0A%0D%0A%23+Download+the+dependencies+zip%0D%0A%24depsZipName+%3D+%22DesktopAppInstaller_Dependencies.zip%22%0D%0A%24depsZipUrl++%3D+Get-AssetUrl+-release+%24latestRelease+-assetName+%24depsZipName%0D%0A%0D%0A%23+We%27ll+expand+to+a+base+%27Dependencies%27+folder%0D%0A%24topDepsFolder+%3D+Join-Path+%24downloadPath+%22Dependencies%22%0D%0A%23+Then+pick+the+sub-folder+for+the+architecture%0D%0A%24depsFolder++++%3D+Join-Path+%24topDepsFolder+%24arch%0D%0A%0D%0Aif+%28%24depsZipUrl%29+%7B%0D%0A++++Write-Host+%22Downloading+%24depsZipName...%22%0D%0A++++%24depsZipPath+%3D+Join-Path+%24downloadPath+%24depsZipName%0D%0A++++Invoke-WebRequest+-Uri+%24depsZipUrl+-OutFile+%24depsZipPath%0D%0A%0D%0A++++%23+Remove+existing+Dependencies+folder+and+expand+the+zip%0D%0A++++if+%28Test-Path+%24topDepsFolder%29+%7B+Remove-Item+-Path+%24topDepsFolder+-Recurse+-Force+%7D%0D%0A+++%0D%0A++++Expand-Archive+-LiteralPath+%24depsZipPath+-DestinationPath+%24topDepsFolder+-Force%0D%0A%7D+%0D%0Aelse+%7B+Write-Warning+%22No+%24depsZipName+found+in+%24latestTag%2C+skipping+dependency+download.%22%3B+%7D%0D%0A%0D%0A%23+Restore+progress+preference%0D%0A%24ProgressPreference+%3D+%27Continue%27%0D%0A%0D%0A%23+If+dependencies+exist+for+this+architecture%2C+install+them%0D%0Aif+%28Test-Path+%24depsFolder%29+%7B%0D%0A++++Install-WingetDependencies+-depsFolder+%24depsFolder%0D%0A%7D+else+%7B%0D%0A++++Write-Warning+%22No+architecture-specific+dependencies+found+at+%24depsFolder%22%0D%0A%7D%0D%0A%0D%0A%23+Finally%2C+install+the+winget+MSIX+bundle%0D%0AWrite-Host+%22Installing+%24msixName...%22%0D%0AAdd-AppxPackage+-Path+%24msixPath%0D%0A%0D%0A%23+Remove+msstore+source+if+set+to+do+so%0D%0Aif+%28%24removeMsStoreAsSource.IsPresent%29+%7B%0D%0A++++Write-Host+%22Attempting+to+remove+%27msstore%27+source+from+winget...%22%0D%0A++++try+%7B%0D%0A++++++++winget+source+remove+-n+msstore+%2D%2Dignore-warnings%0D%0A++++%7D+catch+%7B%0D%0A++++++++Write-Warning+%22An+error+occurred+while+trying+to+execute+%27winget+source+remove+msstore%27%3A+%24%28%24_.Exception.Message%29%22%0D%0A++++%7D%0D%0A%7D+else+%7B%0D%0A++++%23+Automatically+accept+source+agreements+to+avoid+prompts.+Mostly+applies+to+msstore.%0D%0A++++winget+list+%2D%2Daccept-source-agreements+%7C+Out-Null%0D%0A%7D%0D%0AExit%0D%0A&FirstLogonScriptType4=Ps1&FirstLogonScript5=%40echo+off%0D%0Asetlocal+enabledelayedexpansion%0D%0A%0D%0Aecho+Checking+for+installed+applications...%0D%0A%0D%0AREM+Check+if+Brave+is+installed%0D%0Aset+%22BraveInstalled%3Dfalse%22%0D%0Aif+exist+%22%25ProgramFiles%25%5CBraveSoftware%5CBrave-Browser%5CApplication%5Cbrave.exe%22+%28%0D%0A++++set+%22BraveInstalled%3Dtrue%22%0D%0A++++echo+Brave+is+already+installed.%0D%0A%29%0D%0Aif+exist+%22%25ProgramFiles%28x86%29%25%5CBraveSoftware%5CBrave-Browser%5CApplication%5Cbrave.exe%22+%28%0D%0A++++set+%22BraveInstalled%3Dtrue%22%0D%0A++++echo+Brave+is+already+installed.%0D%0A%29%0D%0A%0D%0AREM+Check+if+IrfanView+is+installed%0D%0Aset+%22IrfanViewInstalled%3Dfalse%22%0D%0Aif+exist+%22%25ProgramFiles%25%5CIrfanView%5Ci_view*.exe%22+%28%0D%0A++++set+%22IrfanViewInstalled%3Dtrue%22%0D%0A++++echo+IrfanView+is+already+installed.%0D%0A%29%0D%0Aif+exist+%22%25ProgramFiles%28x86%29%25%5CIrfanView%5Ci_view*.exe%22+%28%0D%0A++++set+%22IrfanViewInstalled%3Dtrue%22%0D%0A++++echo+IrfanView+is+already+installed.%0D%0A%29%0D%0A%0D%0AREM+Check+for+ISO+with+WinApps+directory%0D%0Aset+%22ISOFound%3Dfalse%22%0D%0Aset+%22WinAppsDir%3D%22%0D%0A%0D%0AREM+Create+a+temporary+PowerShell+script+to+find+ISO+drives%0D%0Aecho+%24isoDrives+%3D+Get-Volume+%5E%7C+Where-Object+%7B+%24_.DriveType+-eq+%27CD-ROM%27+-and+%24_.OperationalStatus+-eq+%27OK%27+%7D+%5E%7C+Select-Object+-ExpandProperty+DriveLetter+%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+foreach%28%24drive+in+%24isoDrives%29+%7B+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+++if+%28Test-Path+%22%24drive%60%3A%5CWinApps%22%29+%7B+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+++++Write-Host+%22%24drive%22+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+++++exit+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+++%7D+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0Aecho+%7D+%3E%3E+%22%25TEMP%25%5Cfind_iso.ps1%22%0D%0A%0D%0AREM+Run+the+PowerShell+script+and+capture+its+output%0D%0Afor+%2Ff+%25%25i+in+%28%27powershell+-ExecutionPolicy+Bypass+-File+%22%25TEMP%25%5Cfind_iso.ps1%22%27%29+do+%28%0D%0A++++set+%22IsoDrive%3D%25%25i%22%0D%0A++++set+%22ISOFound%3Dtrue%22%0D%0A++++set+%22WinAppsDir%3D%25%25i%3A%5CWinApps%22%0D%0A++++echo+Found+WinApps+directory+on+drive+%25%25i%3A%0D%0A%29%0D%0A%0D%0AREM+Clean+up+the+temporary+script%0D%0Adel+%22%25TEMP%25%5Cfind_iso.ps1%22+%3E+nul+2%3E%261%0D%0A%0D%0AREM+Install+Brave+if+not+already+installed%0D%0Aif+%22%25BraveInstalled%25%22%3D%3D%22false%22+%28%0D%0A++++echo+Installing+Brave+Browser...%0D%0A++++%0D%0A++++if+%22%25ISOFound%25%22%3D%3D%22true%22+%28%0D%0A++++++++if+exist+%22%25WinAppsDir%25%5Cbrave_silent.exe%22+%28%0D%0A++++++++++++echo+Installing+Brave+from+ISO...%0D%0A++++++++++++start+%2Fwait+%22%22+%22%25WinAppsDir%25%5Cbrave_silent.exe%22%0D%0A++++++++++++echo+Brave+installation+from+ISO+completed.%0D%0A++++++++%29+else+%28%0D%0A++++++++++++echo+Brave+installer+not+found+on+ISO%2C+installing+from+online+source...%0D%0A++++++++++++winget+install+Brave.Brave+%2D%2Daccept-package-agreements+%2D%2Daccept-source-agreements%0D%0A++++++++%29%0D%0A++++%29+else+%28%0D%0A++++++++echo+Installing+Brave+from+online+source...%0D%0A++++++++winget+install+Brave.Brave+%2D%2Daccept-package-agreements+%2D%2Daccept-source-agreements%0D%0A++++%29%0D%0A%29+else+%28%0D%0A++++echo+Skipping+Brave+installation+as+it%27s+already+installed.%0D%0A%29%0D%0A%0D%0AREM+Install+IrfanView+if+not+already+installed%0D%0Aif+%22%25IrfanViewInstalled%25%22%3D%3D%22false%22+%28%0D%0A++++echo+Installing+IrfanView...%0D%0A++++%0D%0A++++if+%22%25ISOFound%25%22%3D%3D%22true%22+%28%0D%0A++++++++if+exist+%22%25WinAppsDir%25%5Ciview_setup.exe%22+%28%0D%0A++++++++++++echo+Installing+IrfanView+from+ISO...%0D%0A++++++++++++start+%2Fwait+%22%22+%22%25WinAppsDir%25%5Ciview_setup.exe%22+%2Fsilent%0D%0A++++++++++++echo+IrfanView+installation+from+ISO+completed.%0D%0A++++++++%29+else+%28%0D%0A++++++++++++echo+IrfanView+installer+not+found+on+ISO%2C+installing+from+online+source...%0D%0A++++++++++++winget+install+IrfanSkiljan.IrfanView+%2D%2Daccept-package-agreements+%2D%2Daccept-source-agreements%0D%0A++++++++%29%0D%0A++++%29+else+%28%0D%0A++++++++echo+Installing+IrfanView+from+online+source...%0D%0A++++++++winget+install+IrfanSkiljan.IrfanView+%2D%2Daccept-package-agreements+%2D%2Daccept-source-agreements%0D%0A++++%29%0D%0A%29+else+%28%0D%0A++++echo+Skipping+IrfanView+installation+as+it%27s+already+installed.%0D%0A%29%0D%0A%0D%0Aecho+Installation+process+completed.%0D%0Aexit+%2Fb+0&FirstLogonScriptType5=Cmd&FirstLogonScript6=foreach%28+%24drive+in+%5BSystem.IO.DriveInfo%5D%3A%3AGetDrives%28%29+%29+%7B%0D%0A++++if%28+%24found+%3D+Join-Path+-Path+%24drive.RootDirectory+-ChildPath+%27sources%5Csxs%27+-Resolve+-ErrorAction+%27SilentlyContinue%27+%29+%7B%0D%0A++++++++Enable-WindowsOptionalFeature+-Online+-FeatureName+%27NetFx3%27+-Source+%24found+-NoRestart%3B%0D%0A++++++++return%3B%0D%0A++++%7D%0D%0A%7D%0D%0A%27Cannot+find+any+files+that+match+pattern.%27+%7C+Write-Warning%3B&FirstLogonScriptType6=Ps1&FirstLogonScript7=param+%28%0D%0A++++%5Bswitch%5D%24Verbose%2C%0D%0A++++%5Bswitch%5D%24OfflineMode%0D%0A%29%0D%0A%0D%0A%23+Check+Internet+connectivity+with+a+10-second+timeout%0D%0AWrite-Output+%22Checking+for+Internet+Connectivity+by+pinging+Google+DNS+8.8.8.8+%2810+sec+timeout%29%22%0D%0A%24pp+%3D+%24ProgressPreference%0D%0A%24ProgressPreference+%3D+%27SilentlyContinue%27%0D%0A%0D%0A%23+Use+Start-Job+to+implement+timeout+for+connectivity+check%0D%0A%24internetAvailable+%3D+%24false%0D%0Atry+%7B%0D%0A++++%24job+%3D+Start-Job+-ScriptBlock+%7B%0D%0A++++++++param%28%24ProgressPref%29%0D%0A++++++++%24ProgressPreference+%3D+%24ProgressPref%0D%0A++++++++test-netconnection+-ComputerName+8.8.8.8+-InformationLevel+Quiet%0D%0A++++%7D+-ArgumentList+%24ProgressPreference%0D%0A%0D%0A++++%23+Wait+up+to+10+seconds+for+the+job+to+complete%0D%0A++++if+%28Wait-Job+-Job+%24job+-Timeout+10%29+%7B%0D%0A++++++++%24internetAvailable+%3D+Receive-Job+-Job+%24job%0D%0A++++++++Write-Output+%22Internet+Connectivity+Check+Completed%21%22%0D%0A++++%7D+else+%7B%0D%0A++++++++Write-Output+%22Internet+Connectivity+Check+timed+out+after+10+seconds.%22%0D%0A++++++++%24internetAvailable+%3D+%24false%0D%0A++++%7D%0D%0A%0D%0A++++%23+Clean+up+the+job%0D%0A++++Remove-Job+-Job+%24job+-Force+-ErrorAction+SilentlyContinue%0D%0A%7D+catch+%7B%0D%0A++++Write-Output+%22Internet+Connectivity+Check+failed+with+error%3A+%24_%22%0D%0A++++%24internetAvailable+%3D+%24false%0D%0A%7D%0D%0A%0D%0A%24ProgressPreference+%3D+%24pp%0D%0A%0D%0A%3C%23%0D%0A.SYNOPSIS%0D%0AThis+PowerShell+script+ensures+it+is+run+with+administrator+privileges%2C+then+installs+the+necessary+Visual+C%2B%2B+Redistributables+and+DirectX+9+End-User+Runtime+silently.+It+provides+progress+updates+throughout+the+installation+process+and+handles+errors+gracefully.%0D%0A%0D%0A.DESCRIPTION%0D%0AThis+script+performs+the+following+tasks%3A%0D%0A-+Checks+if+it+is+run+with+administrator+privileges+and+relaunches+with+elevated+permissions+if+necessary.%0D%0A-+Checks+for+offline+packages+in+the+WinApps+directory+at+the+root+of+the+ISO+or+in+the+script+directory+before+attempting+to+download.%0D%0A-+Downloads+and+installs+the+latest+Visual+C%2B%2B+Redistributables+from+a+Gitlab+repository+if+offline+packages+don%27t+exist.%0D%0A-+Downloads+and+installs+the+DirectX+9+End-User+Runtime+from+Microsoft%27s+official+website+if+offline+packages+don%27t+exist.%0D%0A-+Provides+verbose+logging+for+detailed+output%2C+including+the+URLs+being+accessed%2C+the+files+being+downloaded%2C+and+the+installation+progress.%0D%0A-+Handles+errors+gracefully+by+catching+exceptions+and+providing+meaningful+error+messages.%0D%0A-+Waits+for+user+input+before+exiting+if+an+error+occurs+or+at+the+end+of+the+script%2C+ensuring+that+the+user+is+aware+of+the+script%27s+completion+or+any+issues+that+occurred.%0D%0A%0D%0A.PARAMETER+Verbose%0D%0AEnables+verbose+logging+for+detailed+output.+When+this+switch+is+used%2C+the+script+will+provide+additional+information+about+its+progress+and+actions.%0D%0A%0D%0A.PARAMETER+OfflineMode%0D%0AForces+the+script+to+use+only+offline+packages+and+skip+internet+connectivity+checks.%0D%0A%0D%0A.EXAMPLE%0D%0A.%5CInstall-VCRedistAndDirectX.ps1+-Verbose%0D%0ARuns+the+script+with+verbose+logging+enabled%2C+providing+detailed+output+about+the+script%27s+progress+and+actions.%0D%0A%0D%0A.EXAMPLE%0D%0A.%5CInstall-VCRedistAndDirectX.ps1+-OfflineMode%0D%0ARuns+the+script+in+offline+mode%2C+using+only+locally+available+packages+without+checking+for+internet+connectivity.%0D%0A%0D%0A.EXAMPLE%0D%0A%23+Running+the+script+from+the+Internet%0D%0Airm+https%3A%2F%2Fgist.githubusercontent.com%2Femilwojcik93%2Fef790a6b12c8e9358bbc52ed76fb495c%2Fraw%2FInstall-VCRedistAndDirectX.ps1+%7C+iex%0D%0ADownloads+and+runs+the+script+directly+from+the+provided+URL%2C+ensuring+that+the+latest+version+is+used.%0D%0A%0D%0A.LINK%0D%0Ahttps%3A%2F%2Fgist.github.com%2Femilwojcik93%2Fef790a6b12c8e9358bbc52ed76fb495c%0D%0A%23%3E%0D%0A%0D%0A%0D%0Aif+%28%21%28%5BSecurity.Principal.WindowsPrincipal%5D%5BSecurity.Principal.WindowsIdentity%5D%3A%3AGetCurrent%28%29%29.IsInRole%28%5BSecurity.Principal.WindowsBuiltInRole%5D%3A%3AAdministrator%29%29+%7B%0D%0A++++Write-Output+%22This+script+needs+to+be+run+as+Administrator.+Attempting+to+relaunch.%22%0D%0A++++%24argList+%3D+%40%28%29%0D%0A%0D%0A++++%24PSBoundParameters.GetEnumerator%28%29+%7C+ForEach-Object+%7B%0D%0A++++++++%24argList+%2B%3D+if+%28%24_.Value+-is+%5Bswitch%5D+-and+%24_.Value%29+%7B%0D%0A++++++++++++%22-%24%28%24_.Key%29%22%0D%0A++++++++%7D+elseif+%28%24_.Value%29+%7B%0D%0A++++++++++++%22-%24%28%24_.Key%29+%60%22%24%28%24_.Value%29%60%22%22%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%0D%0A%0D%0A++++%24script+%3D+if+%28%24PSCommandPath%29+%7B%0D%0A++++++++%22%26+%7B+%26+%60%22%24%28%24PSCommandPath%29%60%22+%24%7BargList%7D+%7D%22%0D%0A++++%7D+else+%7B%0D%0A++++++++%22%26%28%5BScriptBlock%5D%3A%3ACreate%28%28irm+https%3A%2F%2Fgist.githubusercontent.com%2Femilwojcik93%2Fef790a6b12c8e9358bbc52ed76fb495c%2Fraw%2FInstall-VCRedistAndDirectX.ps1%29%29%29+%24%7BargList%7D%22%0D%0A++++%7D%0D%0A%0D%0A++++%24powershellcmd+%3D+if+%28Get-Command+pwsh+-ErrorAction+SilentlyContinue%29+%7B+%22pwsh%22+%7D+else+%7B+%22powershell%22+%7D%0D%0A++++%24processCmd+%3D+if+%28Get-Command+wt.exe+-ErrorAction+SilentlyContinue%29+%7B+%22wt.exe%22+%7D+else+%7B+%24powershellcmd+%7D%0D%0A%0D%0A++++Start-Process+%24processCmd+-ArgumentList+%22%24powershellcmd+-ExecutionPolicy+Bypass+-NoProfile+-Command+%24script%22+-Verb+RunAs%0D%0A%0D%0A++++break%0D%0A%7D%0D%0A%0D%0A%23+Function+to+check+if+the+parent+process+is+explorer.exe%0D%0Afunction+Is-StartedByExplorer+%7B%0D%0A++++%24parentProcess+%3D+Get-WmiObject+Win32_Process+-Filter+%22ProcessId%3D%24%28%28Get-WmiObject+Win32_Process+-Filter+%22ProcessId%3D%24PID%22%29.ParentProcessId%29%22%0D%0A++++return+%24parentProcess.Name+-eq+%22explorer.exe%22%0D%0A%7D%0D%0A%0D%0A%23+Function+to+check+if+the+session+is+likely+to+close+at+the+end+of+the+script%0D%0Afunction+Is-SessionLikelyToClose+%7B%0D%0A++++%24commandLineArgs+%3D+%5BEnvironment%5D%3A%3AGetCommandLineArgs%28%29%0D%0A++++return+%28%24commandLineArgs+-contains+%22-NoProfile%22%29%0D%0A%7D%0D%0A%0D%0A%23+Function+to+check+if+offline+packages+exist%0D%0Afunction+Test-OfflinePackages+%7B%0D%0A++++param+%28%0D%0A++++++++%5Bstring%5D%24PackageName%0D%0A++++%29%0D%0A%0D%0A++++%23+First%2C+check+in+the+WinApps+directory+at+the+root+of+the+ISO%0D%0A++++%23+Try+to+find+the+ISO+drive+letter%0D%0A++++%24isoDrives+%3D+Get-Volume+%7C+Where-Object+%7B+%24_.DriveType+-eq+%27CD-ROM%27+-and+%24_.OperationalStatus+-eq+%27OK%27+%7D+%7C+Select-Object+-ExpandProperty+DriveLetter%0D%0A++++%24packagePath+%3D+%24null%0D%0A%0D%0A++++%23+Check+each+potential+ISO+drive+for+the+WinApps+directory%0D%0A++++foreach+%28%24driveLetter+in+%24isoDrives%29+%7B%0D%0A++++++++%24winAppsPath+%3D+%22%24%7BdriveLetter%7D%3A%5CWinApps%22%0D%0A++++++++Write-Verbose+%22Checking+for+WinApps+directory+in+drive+%24%7BdriveLetter%7D%3A+%24winAppsPath%22%0D%0A%0D%0A++++++++if+%28Test-Path+%24winAppsPath%29+%7B%0D%0A++++++++++++Write-Verbose+%22Found+WinApps+directory+in+drive+%24%7BdriveLetter%7D%22%0D%0A%0D%0A++++++++++++switch+%28%24PackageName%29+%7B%0D%0A++++++++++++++++%22VCRedist%22+%7B%0D%0A++++++++++++++++++++%24vcRedistFile+%3D+Join-Path+%24winAppsPath+%22VisualCppRedist_AIO_x86_x64.exe%22%0D%0A++++++++++++++++++++if+%28Test-Path+%24vcRedistFile%29+%7B%0D%0A++++++++++++++++++++++++Write-Verbose+%22Found+VCRedist+package+in+ISO+WinApps+directory%22%0D%0A++++++++++++++++++++++++return+%24true%2C+%24vcRedistFile%0D%0A++++++++++++++++++++%7D%0D%0A++++++++++++++++%7D%0D%0A++++++++++++++++%22DirectX%22+%7B%0D%0A++++++++++++++++++++%24directXFile+%3D+Join-Path+%24winAppsPath+%22DirectX_Redist_Repack_x86_x64.exe%22%0D%0A++++++++++++++++++++if+%28Test-Path+%24directXFile%29+%7B%0D%0A++++++++++++++++++++++++Write-Verbose+%22Found+DirectX+package+in+ISO+WinApps+directory%22%0D%0A++++++++++++++++++++++++return+%24true%2C+%24directXFile%0D%0A++++++++++++++++++++%7D%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%0D%0A++++%23+If+not+found+in+ISO%2C+fallback+to+script+directory%0D%0A++++%24scriptDirectory+%3D+if+%28%24PSCommandPath%29+%7B%0D%0A++++++++Split-Path+-Parent+%24PSCommandPath%0D%0A++++%7D+else+%7B%0D%0A++++++++%24PWD.Path%0D%0A++++%7D%0D%0A%0D%0A++++%24offlineDirectory+%3D+Join-Path+%24scriptDirectory+%22offline-packages%22%0D%0A%0D%0A++++switch+%28%24PackageName%29+%7B%0D%0A++++++++%22VCRedist%22+%7B%0D%0A++++++++++++%24vcRedistFile+%3D+Join-Path+%24offlineDirectory+%22VisualCppRedist_AIO_x86_x64.exe%22%0D%0A++++++++++++return+%28Test-Path+%24vcRedistFile%29%2C+%24vcRedistFile%0D%0A++++++++%7D%0D%0A++++++++%22DirectX%22+%7B%0D%0A++++++++++++%24directXFile+%3D+Join-Path+%24offlineDirectory+%22DirectX_Redist_Repack_x86_x64.exe%22%0D%0A++++++++++++return+%28Test-Path+%24directXFile%29%2C+%24directXFile%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%0D%0A++++return+%24false%2C+%24null%0D%0A%7D%0D%0A%0D%0Afunction+Get-LatestReleaseUrl+%7B%0D%0A++++param+%28%0D%0A++++++++%5Bstring%5D%24RepoUrl%2C%0D%0A++++++++%5Bstring%5D%24FilePattern%0D%0A++++%29%0D%0A%0D%0A++++Write-Verbose+%22Fetching+the+latest+release+URL+from+%24RepoUrl...%22%0D%0A++++%24apiUrl+%3D+%22%24RepoUrl%2Freleases%2Flatest%22%0D%0A++++try+%7B%0D%0A++++++++%24response+%3D+Invoke-RestMethod+-Uri+%24apiUrl+-UseBasicParsing%0D%0A++++%7D+catch+%7B%0D%0A++++++++Write-Error+%22Failed+to+access+the+URL%3A+%24RepoUrl%22%0D%0A++++++++return+%24null%0D%0A++++%7D%0D%0A%0D%0A++++%24latestAsset+%3D+%24response.assets+%7C+Where-Object+%7B+%24_.name+-like+%24FilePattern+%7D%0D%0A++++if+%28%24null+-eq+%24latestAsset%29+%7B%0D%0A++++++++Write-Error+%22No+file+matching+the+pattern+%27%24FilePattern%27+found+in+the+latest+release.%22%0D%0A++++++++return+%24null%0D%0A++++%7D%0D%0A%0D%0A++++%24downloadUrl+%3D+%24latestAsset.browser_download_url%0D%0A++++Write-Verbose+%22Latest+release+URL%3A+%24downloadUrl%22%0D%0A++++return+%24downloadUrl%0D%0A%7D%0D%0A%0D%0Afunction+Download+%7B%0D%0A++++param+%28%0D%0A++++++++%5Bstring%5D%24Url%2C%0D%0A++++++++%5Bstring%5D%24Destination%2C%0D%0A++++++++%5Bstring%5D%24FileType%0D%0A++++%29%0D%0A%0D%0A++++Write-Verbose+%22Download+called+with+Url%3A+%24Url%2C+Destination%3A+%24Destination%2C+FileType%3A+%24FileType%22%0D%0A%0D%0A++++if+%28Test-Path+%24Destination%29+%7B%0D%0A++++++++Write-Verbose+%22Removing+existing+directory%3A+%24Destination%22%0D%0A++++++++Remove-Item+-Path+%24Destination+-Recurse+-Force+-ErrorAction+SilentlyContinue%0D%0A++++%7D%0D%0A++++Write-Verbose+%22Creating+directory%3A+%24Destination%22%0D%0A++++New-Item+-ItemType+Directory+-Force+-Path+%24Destination%0D%0A%0D%0A++++%24fileName+%3D+%5BSystem.IO.Path%5D%3A%3AGetFileName%28%24Url%29%0D%0A++++%24filePath+%3D+%22%24Destination%5C%24fileName%22%0D%0A++++Write-Verbose+%22Downloading+file+from+URL%3A+%24Url+to+%24filePath%22%0D%0A++++try+%7B%0D%0A++++++++Invoke-WebRequest+-Uri+%24Url+-OutFile+%24filePath+-ErrorAction+Stop%0D%0A++++%7D+catch+%7B%0D%0A++++++++Write-Error+%22Failed+to+download+the+file+from+URL%3A+%24Url%22%0D%0A++++++++return+%24null%0D%0A++++%7D%0D%0A%0D%0A++++if+%28-not+%28Test-Path+%24filePath%29%29+%7B%0D%0A++++++++Write-Error+%22Downloaded+file+not+found%3A+%24filePath%22%0D%0A++++++++return+%24null%0D%0A++++%7D%0D%0A%0D%0A++++Write-Verbose+%22Downloading+completed+for+file%3A+%24filePath%22%0D%0A%7D%0D%0A%0D%0Afunction+Install-VCRedist+%7B%0D%0A++++Write-Output+%22Installing+Visual+C%2B%2B+Redistributables...%22%0D%0A%0D%0A++++%23+Check+for+offline+package%0D%0A++++%24offlineExists%2C+%24offlinePath+%3D+Test-OfflinePackages+-PackageName+%22VCRedist%22%0D%0A++++%24vcRedistInstaller+%3D+%24null%0D%0A%0D%0A++++if+%28%24offlineExists%29+%7B%0D%0A++++++++Write-Verbose+%22Found+offline+VCRedist+package%3A+%24offlinePath%22%0D%0A++++++++%24vcRedistInstaller+%3D+%24offlinePath%0D%0A++++%7D+else+%7B%0D%0A++++++++%23+If+Internet+check+timed+out+or+failed%2C+try+to+find+the+installer+in+WinApps+folder+on+ISO%0D%0A++++++++if+%28-not+%24internetAvailable+-or+%24OfflineMode%29+%7B%0D%0A++++++++++++%23+Check+for+ISO+WinApps+directory+using+the+same+approach+as+Install-BraveAndIrfanView.cmd%0D%0A++++++++++++Write-Output+%22No+internet+connection+or+offline+mode+enabled%2C+checking+ISO+for+VCRedist+package...%22%0D%0A%0D%0A++++++++++++%23+Create+a+similar+approach+to+the+CMD+script+with+clearly+defined+variables%0D%0A++++++++++++%24ISOFound+%3D+%24false%0D%0A++++++++++++%24WinAppsDir+%3D+%24null%0D%0A%0D%0A++++++++++++%23+Create+a+temporary+script+to+find+ISO+with+WinApps+directory%0D%0A++++++++++++%24tempScriptPath+%3D+Join-Path+%24env%3ATEMP+%22find_iso.ps1%22%0D%0A++++++++++++%40%22%0D%0A%60%24isoDrives+%3D+Get-Volume+%7C+Where-Object+%7B+%60%24_.DriveType+-eq+%27CD-ROM%27+-and+%60%24_.OperationalStatus+-eq+%27OK%27+%7D+%7C+Select-Object+-ExpandProperty+DriveLetter%0D%0Aforeach%28%60%24drive+in+%60%24isoDrives%29+%7B%0D%0A++if+%28Test-Path+%22%60%24%7Bdrive%7D%3A%5CWinApps%22%29+%7B%0D%0A++++Write-Host+%22%60%24drive%22%0D%0A++++exit%0D%0A++%7D%0D%0A%7D%0D%0A%22%40+%7C+Out-File+-FilePath+%24tempScriptPath+-Encoding+utf8%0D%0A%0D%0A++++++++++++try+%7B%0D%0A++++++++++++++++%23+Execute+the+temporary+script+to+find+the+ISO%0D%0A++++++++++++++++%24isoDrive+%3D+%26+powershell+-ExecutionPolicy+Bypass+-File+%24tempScriptPath%0D%0A%0D%0A++++++++++++++++if+%28%24isoDrive%29+%7B%0D%0A++++++++++++++++++++%24ISOFound+%3D+%24true%0D%0A++++++++++++++++++++%24WinAppsDir+%3D+%22%24%7BisoDrive%7D%3A%5CWinApps%22%0D%0A++++++++++++++++++++Write-Output+%22Found+WinApps+directory+on+drive+%24%7BisoDrive%7D%3A%22%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A++++++++++++finally+%7B%0D%0A++++++++++++++++%23+Clean+up+the+temporary+script%0D%0A++++++++++++++++if+%28Test-Path+%24tempScriptPath%29+%7B%0D%0A++++++++++++++++++++Remove-Item+-Path+%24tempScriptPath+-Force%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A%0D%0A++++++++++++%23+Check+for+VCRedist+in+the+WinApps+directory%0D%0A++++++++++++if+%28%24ISOFound%29+%7B%0D%0A++++++++++++++++%24vcRedistPath+%3D+Join-Path+%24WinAppsDir+%22VisualCppRedist_AIO_x86_x64.exe%22%0D%0A++++++++++++++++if+%28Test-Path+%24vcRedistPath%29+%7B%0D%0A++++++++++++++++++++Write-Output+%22Found+VCRedist+package+in+ISO+WinApps+directory%3A+%24vcRedistPath%22%0D%0A++++++++++++++++++++%24vcRedistInstaller+%3D+%24vcRedistPath%0D%0A++++++++++++++++%7D+else+%7B%0D%0A++++++++++++++++++++throw+%22VCRedist+package+not+found+in+WinApps+directory+on+ISO.%22%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D+else+%7B%0D%0A++++++++++++++++throw+%22No+internet+connection+available+and+no+ISO+with+WinApps+directory+found.%22%0D%0A++++++++++++%7D%0D%0A++++++++%7D+else+%7B%0D%0A++++++++++++%23+If+we+have+internet%2C+try+downloading+as+usual%0D%0A++++++++++++Write-Output+%22Downloading+Visual+C%2B%2B+Redistributables...%22%0D%0A++++++++++++%24vcRedistUrl+%3D+%22https%3A%2F%2Fgitlab.com%2F-%2Fproject%2F76069787%2Fuploads%2F4431f3448fa76633cfd4983142f81952%2FVisualCppRedist_AIO_x86_x64.exe%22%0D%0A++++++++++++if+%28%24null+-eq+%24vcRedistUrl%29+%7B%0D%0A++++++++++++++++throw+%22Failed+to+get+the+latest+Visual+C%2B%2B+Redistributables+URL.%22%0D%0A++++++++++++%7D%0D%0A%0D%0A++++++++++++Write-Verbose+%22Visual+C%2B%2B+Redistributables+URL%3A+%24vcRedistUrl%22%0D%0A%0D%0A++++++++++++%24tempDir+%3D+%22%24env%3ATEMP%5CVcRedist%22%0D%0A++++++++++++%24result+%3D+Download+-Url+%22%24vcRedistUrl%22+-Destination+%22%24tempDir%22+-FileType+%22exe%22%0D%0A++++++++++++if+%28%24null+-eq+%24result%29+%7B%0D%0A++++++++++++++++throw+%22Failed+to+download+Visual+C%2B%2B+Redistributables.%22%0D%0A++++++++++++%7D%0D%0A%0D%0A++++++++++++%24vcRedistInstaller+%3D+%22%24tempDir%5CVisualCppRedist_AIO_x86_x64.exe%22%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%0D%0A++++if+%28-not+%28Test-Path+%24vcRedistInstaller%29%29+%7B%0D%0A++++++++throw+%22Installer+file+not+found%3A+%24vcRedistInstaller%22%0D%0A++++%7D%0D%0A%0D%0A++++Write-Verbose+%22Running+installer%3A+%24vcRedistInstaller+with+arguments%3A+%2Fai+%2Fgm2%22%0D%0A++++%23+Create+a+ProcessStartInfo+object+to+set+more+detailed+parameters%0D%0A++++%24processInfo+%3D+New-Object+System.Diagnostics.ProcessStartInfo%0D%0A++++%24processInfo.FileName+%3D+%24vcRedistInstaller%0D%0A++++%24processInfo.Arguments+%3D+%22%2Fai+%2Fgm2%22%0D%0A++++%24processInfo.UseShellExecute+%3D+%24true%0D%0A++++%24processInfo.Verb+%3D+%22runas%22%0D%0A%0D%0A++++%23+Start+the+process%0D%0A++++%24process+%3D+%5BSystem.Diagnostics.Process%5D%3A%3AStart%28%24processInfo%29%0D%0A++++%24process.WaitForExit%28%29%0D%0A%0D%0A++++Write-Output+%22Visual+C%2B%2B+Redistributables+installation+completed.%22%0D%0A%7D%0D%0A%0D%0Afunction+Install-DirectX+%7B%0D%0A++++Write-Output+%22Installing+DirectX+9+End-User+Runtime...%22%0D%0A++++%24ErrorActionPreference+%3D+%27Stop%27%0D%0A%0D%0A++++%23+Check+for+offline+package%0D%0A++++%24offlineExists%2C+%24offlinePath+%3D+Test-OfflinePackages+-PackageName+%22DirectX%22%0D%0A++++%24directxInstaller+%3D+%24null%0D%0A++++%24tempDir+%3D+%22%24env%3ATEMP%5Cdirectx%22%0D%0A%0D%0A++++if+%28%24offlineExists%29+%7B%0D%0A++++++++Write-Verbose+%22Found+offline+DirectX+package%3A+%24offlinePath%22%0D%0A++++++++%24directxInstaller+%3D+%24offlinePath%0D%0A%0D%0A++++++++%23+For+offline+packages%2C+we+use+the+%22%2Fai+%2Fgm2%22+arguments+directly%0D%0A++++++++Write-Verbose+%22Installing+offline+DirectX+package+with+arguments%3A+%2Fai+%2Fgm2%22%0D%0A++++++++%23+Create+a+ProcessStartInfo+object+to+set+more+detailed+parameters%0D%0A++++++++%24processInfo+%3D+New-Object+System.Diagnostics.ProcessStartInfo%0D%0A++++++++%24processInfo.FileName+%3D+%24directxInstaller%0D%0A++++++++%24processInfo.Arguments+%3D+%22%2Fai+%2Fgm2%22%0D%0A++++++++%24processInfo.UseShellExecute+%3D+%24true%0D%0A++++++++%24processInfo.Verb+%3D+%22runas%22%0D%0A%0D%0A++++++++%23+Start+the+process%0D%0A++++++++%24process+%3D+%5BSystem.Diagnostics.Process%5D%3A%3AStart%28%24processInfo%29%0D%0A++++++++%24process.WaitForExit%28%29%0D%0A++++++++Write-Output+%22DirectX+installation+from+offline+package+completed.%22%0D%0A++++++++return%0D%0A++++%7D+else+%7B%0D%0A++++++++%23+If+Internet+check+timed+out+or+failed%2C+try+to+find+the+installer+in+WinApps+folder+on+ISO%0D%0A++++++++if+%28-not+%24internetAvailable+-or+%24OfflineMode%29+%7B%0D%0A++++++++++++%23+Check+for+ISO+WinApps+directory+using+the+same+approach+as+Install-BraveAndIrfanView.cmd%0D%0A++++++++++++Write-Output+%22No+internet+connection+or+offline+mode+enabled%2C+checking+ISO+for+DirectX+package...%22%0D%0A%0D%0A++++++++++++%23+Create+a+similar+approach+to+the+CMD+script+with+clearly+defined+variables%0D%0A++++++++++++%24ISOFound+%3D+%24false%0D%0A++++++++++++%24WinAppsDir+%3D+%24null%0D%0A%0D%0A++++++++++++%23+Create+a+temporary+script+to+find+ISO+with+WinApps+directory%0D%0A++++++++++++%24tempScriptPath+%3D+Join-Path+%24env%3ATEMP+%22find_iso.ps1%22%0D%0A++++++++++++%40%22%0D%0A%60%24isoDrives+%3D+Get-Volume+%7C+Where-Object+%7B+%60%24_.DriveType+-eq+%27CD-ROM%27+-and+%60%24_.OperationalStatus+-eq+%27OK%27+%7D+%7C+Select-Object+-ExpandProperty+DriveLetter%0D%0Aforeach%28%60%24drive+in+%60%24isoDrives%29+%7B%0D%0A++if+%28Test-Path+%22%60%24%7Bdrive%7D%3A%5CWinApps%22%29+%7B%0D%0A++++Write-Host+%22%60%24drive%22%0D%0A++++exit%0D%0A++%7D%0D%0A%7D%0D%0A%22%40+%7C+Out-File+-FilePath+%24tempScriptPath+-Encoding+utf8%0D%0A%0D%0A++++++++++++try+%7B%0D%0A++++++++++++++++%23+Execute+the+temporary+script+to+find+the+ISO%0D%0A++++++++++++++++%24isoDrive+%3D+%26+powershell+-ExecutionPolicy+Bypass+-File+%24tempScriptPath%0D%0A%0D%0A++++++++++++++++if+%28%24isoDrive%29+%7B%0D%0A++++++++++++++++++++%24ISOFound+%3D+%24true%0D%0A++++++++++++++++++++%24WinAppsDir+%3D+%22%24%7BisoDrive%7D%3A%5CWinApps%22%0D%0A++++++++++++++++++++Write-Output+%22Found+WinApps+directory+on+drive+%24%7BisoDrive%7D%3A%22%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A++++++++++++finally+%7B%0D%0A++++++++++++++++%23+Clean+up+the+temporary+script%0D%0A++++++++++++++++if+%28Test-Path+%24tempScriptPath%29+%7B%0D%0A++++++++++++++++++++Remove-Item+-Path+%24tempScriptPath+-Force%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A%0D%0A++++++++++++%23+Check+for+DirectX+in+the+WinApps+directory%0D%0A++++++++++++if+%28%24ISOFound%29+%7B%0D%0A++++++++++++++++%24directxPath+%3D+Join-Path+%24WinAppsDir+%22DirectX_Redist_Repack_x86_x64.exe%22%0D%0A++++++++++++++++if+%28Test-Path+%24directxPath%29+%7B%0D%0A++++++++++++++++++++Write-Output+%22Found+DirectX+package+in+ISO+WinApps+directory%3A+%24directxPath%22%0D%0A++++++++++++++++++++%24directxInstaller+%3D+%24directxPath%0D%0A%0D%0A++++++++++++++++++++%23+For+offline+packages+from+ISO%2C+we+use+the+%22%2Fai+%2Fgm2%22+arguments+directly%0D%0A++++++++++++++++++++Write-Verbose+%22Installing+DirectX+package+from+ISO+with+arguments%3A+%2Fai+%2Fgm2%22%0D%0A++++++++++++++++++++%23+Create+a+ProcessStartInfo+object+to+set+more+detailed+parameters%0D%0A++++++++++++++++++++%24processInfo+%3D+New-Object+System.Diagnostics.ProcessStartInfo%0D%0A++++++++++++++++++++%24processInfo.FileName+%3D+%24directxInstaller%0D%0A++++++++++++++++++++%24processInfo.Arguments+%3D+%22%2Fai+%2Fgm2%22%0D%0A++++++++++++++++++++%24processInfo.UseShellExecute+%3D+%24true%0D%0A++++++++++++++++++++%24processInfo.Verb+%3D+%22runas%22%0D%0A%0D%0A++++++++++++++++++++%23+Start+the+process%0D%0A++++++++++++++++++++%24process+%3D+%5BSystem.Diagnostics.Process%5D%3A%3AStart%28%24processInfo%29%0D%0A++++++++++++++++++++%24process.WaitForExit%28%29%0D%0A++++++++++++++++++++Write-Output+%22DirectX+installation+from+ISO+completed.%22%0D%0A++++++++++++++++++++return%0D%0A++++++++++++++++%7D+else+%7B%0D%0A++++++++++++++++++++throw+%22DirectX+package+not+found+in+WinApps+directory+on+ISO.%22%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D+else+%7B%0D%0A++++++++++++++++throw+%22No+internet+connection+available+and+no+ISO+with+WinApps+directory+found.%22%0D%0A++++++++++++%7D%0D%0A++++++++%7D%0D%0A%0D%0A++++++++Write-Output+%22Downloading+DirectX+9+End-User+Runtime...%22%0D%0A++++++++%23+Ensure+the+temporary+directory+is+clean%0D%0A++++++++if+%28Test-Path+%24tempDir%29+%7B%0D%0A++++++++++++Write-Verbose+%22Removing+existing+directory%3A+%24tempDir%22%0D%0A++++++++++++Remove-Item+-Path+%24tempDir+-Recurse+-Force+-ErrorAction+SilentlyContinue%0D%0A++++++++%7D%0D%0A++++++++Write-Verbose+%22Creating+directory%3A+%24tempDir%22%0D%0A++++++++New-Item+-ItemType+Directory+-Force+-Path+%24tempDir+%3E+%24null%0D%0A%0D%0A++++++++%24directxUrl+%3D+%22https%3A%2F%2Fdownload.microsoft.com%2Fdownload%2F8%2F4%2FA%2F84A35BF1-DAFE-4AE8-82AF-AD2AE20B6B14%2Fdirectx_Jun2010_redist.exe%22%0D%0A++++++++%24directxInstaller+%3D+%22%24tempDir%5Cdirectx_Jun2010_redist.exe%22%0D%0A++++++++Write-Verbose+%22Downloading+DirectX+from+URL%3A+%24directxUrl+to+%24directxInstaller%22%0D%0A++++++++Invoke-WebRequest+-Uri+%24directxUrl+-OutFile+%24directxInstaller%0D%0A%0D%0A++++++++if+%28-not+%28Test-Path+%24directxInstaller%29%29+%7B%0D%0A++++++++++++throw+%22DirectX+installer+not+found%3A+%24directxInstaller%22%0D%0A++++++++%7D%0D%0A%0D%0A++++++++Write-Verbose+%22Extracting+DirectX+9+End-User+Runtime...%22%0D%0A++++++++%23+Create+a+ProcessStartInfo+object+for+extraction%0D%0A++++++++%24extractInfo+%3D+New-Object+System.Diagnostics.ProcessStartInfo%0D%0A++++++++%24extractInfo.FileName+%3D+%24directxInstaller%0D%0A++++++++%24extractInfo.Arguments+%3D+%22%2FQ+%2FT%3A%24tempDir%22%0D%0A++++++++%24extractInfo.UseShellExecute+%3D+%24true%0D%0A++++++++%24extractInfo.Verb+%3D+%22runas%22%0D%0A%0D%0A++++++++%23+Start+the+extraction+process%0D%0A++++++++%24extractProcess+%3D+%5BSystem.Diagnostics.Process%5D%3A%3AStart%28%24extractInfo%29%0D%0A++++++++%24extractProcess.WaitForExit%28%29%0D%0A%0D%0A++++++++%24dxSetup+%3D+%22%24tempDir%5CDXSETUP.exe%22%0D%0A++++++++if+%28-not+%28Test-Path+%24dxSetup%29%29+%7B%0D%0A++++++++++++throw+%22DXSETUP.exe+not+found+in+%24tempDir%22%0D%0A++++++++%7D%0D%0A%0D%0A++++++++Write-Verbose+%22Installing+DirectX+9+End-User+Runtime+from+%24dxSetup+with+arguments%3A+%2Fsilent%22%0D%0A++++++++%23+Create+a+ProcessStartInfo+object+for+installation%0D%0A++++++++%24installInfo+%3D+New-Object+System.Diagnostics.ProcessStartInfo%0D%0A++++++++%24installInfo.FileName+%3D+%24dxSetup%0D%0A++++++++%24installInfo.Arguments+%3D+%22%2Fsilent%22%0D%0A++++++++%24installInfo.UseShellExecute+%3D+%24true%0D%0A++++++++%24installInfo.Verb+%3D+%22runas%22%0D%0A%0D%0A++++++++%23+Start+the+installation+process%0D%0A++++++++%24installProcess+%3D+%5BSystem.Diagnostics.Process%5D%3A%3AStart%28%24installInfo%29%0D%0A++++++++%24installProcess.WaitForExit%28%29%0D%0A++++%7D%0D%0A%0D%0A++++Write-Output+%22DirectX+9+End-User+Runtime+installation+completed.%22%0D%0A%7D%0D%0A%0D%0Afunction+Main+%7B%0D%0A++++%23+Variable+to+track+if+an+error+occurred%0D%0A++++%24errorOccurred+%3D+%24false%0D%0A%0D%0A++++try+%7B%0D%0A++++++++Write-Output+%22Starting+installation+process...%22%0D%0A%0D%0A++++++++%23+Create+offline+packages+directory+if+it+doesn%27t+exist%0D%0A++++++++if+%28%24PSCommandPath%29+%7B%0D%0A++++++++++++%24offlineDir+%3D+Join-Path+%28Split-Path+-Parent+%24PSCommandPath%29+%22offline-packages%22%0D%0A++++++++++++if+%28-not+%28Test-Path+%24offlineDir%29%29+%7B%0D%0A++++++++++++++++Write-Verbose+%22Creating+offline+packages+directory%3A+%24offlineDir%22%0D%0A++++++++++++++++New-Item+-ItemType+Directory+-Force+-Path+%24offlineDir+%3E+%24null%0D%0A++++++++++++%7D%0D%0A%0D%0A++++++++++++%23+Check+if+we%27re+running+from+an+ISO+with+WinApps+directory%0D%0A++++++++++++%24isoDrives+%3D+Get-Volume+%7C+Where-Object+%7B+%24_.DriveType+-eq+%27CD-ROM%27+-and+%24_.OperationalStatus+-eq+%27OK%27+%7D+%7C+Select-Object+-ExpandProperty+DriveLetter%0D%0A++++++++++++foreach+%28%24driveLetter+in+%24isoDrives%29+%7B%0D%0A++++++++++++++++%24winAppsPath+%3D+%22%24%7BdriveLetter%7D%3A%5CWinApps%22%0D%0A++++++++++++++++if+%28Test-Path+%24winAppsPath%29+%7B%0D%0A++++++++++++++++++++Write-Verbose+%22Found+WinApps+directory+in+ISO+drive+%24%7BdriveLetter%7D%22%0D%0A++++++++++++++++++++break%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D%0D%0A++++++++%7D%0D%0A%0D%0A++++++++Install-VCRedist%0D%0A++++++++Install-DirectX%0D%0A++++++++Write-Output+%22Installation+process+completed+successfully.%22%0D%0A++++%7D+catch+%7B%0D%0A++++++++%24errorOccurred+%3D+%24true%0D%0A++++++++Write-Error+%22An+error+occurred%3A+%24_%22%0D%0A++++%7D+finally+%7B%0D%0A++++++++%23+Wait+for+user+input+before+exiting+ONLY+if+an+error+occurs%0D%0A++++++++%23+AND+if+the+script+is+started+by+explorer+and+running+as+administrator%0D%0A++++++++%23+or+if+the+session+is+likely+to+close+at+the+end+of+the+script%0D%0A++++++++if+%28%24errorOccurred+-and+%28%28Is-StartedByExplorer%29+-and+%28%5BSecurity.Principal.WindowsPrincipal%5D%5BSecurity.Principal.WindowsIdentity%5D%3A%3AGetCurrent%28%29%29.IsInRole%28%5BSecurity.Principal.WindowsBuiltInRole%5D%3A%3AAdministrator%29+-or+%28Is-SessionLikelyToClose%29%29%29+%7B%0D%0A++++++++++++Read-Host+%22Press+Enter+to+exit%22%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%7D%0D%0A%0D%0AMain+-Verbose%3A%24Verbose%0D%0AExit&FirstLogonScriptType7=Ps1&RestartExplorer=true&WdacMode=Skip-->
	<settings pass="offlineServicing"></settings>
	<settings pass="windowsPE">
		<component name="Microsoft-Windows-Setup" processorArchitecture="x86" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserData>
				<ProductKey>
					<Key>00000-00000-00000-00000-00000</Key>
					<WillShowUI>Always</WillShowUI>
				</ProductKey>
				<AcceptEula>true</AcceptEula>
			</UserData>
			<UseConfigurationSet>false</UseConfigurationSet>
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
		<component name="Microsoft-Windows-Setup" processorArchitecture="arm64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserData>
				<ProductKey>
					<Key>00000-00000-00000-00000-00000</Key>
					<WillShowUI>Always</WillShowUI>
				</ProductKey>
				<AcceptEula>true</AcceptEula>
			</UserData>
			<UseConfigurationSet>false</UseConfigurationSet>
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
		<component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserData>
				<ProductKey>
					<Key>00000-00000-00000-00000-00000</Key>
					<WillShowUI>Always</WillShowUI>
				</ProductKey>
				<AcceptEula>true</AcceptEula>
			</UserData>
			<UseConfigurationSet>false</UseConfigurationSet>
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
	</settings>
	<settings pass="generalize"></settings>
	<settings pass="specialize">
		<component name="Microsoft-Windows-Deployment" processorArchitecture="x86" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "$xml = [xml]::new(); $xml.Load('C:\Windows\Panther\unattend.xml'); $sb = [scriptblock]::Create( $xml.unattend.Extensions.ExtractScript ); Invoke-Command -ScriptBlock $sb -ArgumentList $xml;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\Specialize.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe load "HKU\DefaultUser" "C:\Users\Default\NTUSER.DAT"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>4</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\DefaultUser.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>5</Order>
					<Path>reg.exe unload "HKU\DefaultUser"</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
		<component name="Microsoft-Windows-Deployment" processorArchitecture="arm64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "$xml = [xml]::new(); $xml.Load('C:\Windows\Panther\unattend.xml'); $sb = [scriptblock]::Create( $xml.unattend.Extensions.ExtractScript ); Invoke-Command -ScriptBlock $sb -ArgumentList $xml;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\Specialize.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe load "HKU\DefaultUser" "C:\Users\Default\NTUSER.DAT"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>4</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\DefaultUser.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>5</Order>
					<Path>reg.exe unload "HKU\DefaultUser"</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
		<component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<RunSynchronous>
				<RunSynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "$xml = [xml]::new(); $xml.Load('C:\Windows\Panther\unattend.xml'); $sb = [scriptblock]::Create( $xml.unattend.Extensions.ExtractScript ); Invoke-Command -ScriptBlock $sb -ArgumentList $xml;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\Specialize.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>reg.exe load "HKU\DefaultUser" "C:\Users\Default\NTUSER.DAT"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>4</Order>
					<Path>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\DefaultUser.ps1' -Raw | Invoke-Expression;"</Path>
				</RunSynchronousCommand>
				<RunSynchronousCommand wcm:action="add">
					<Order>5</Order>
					<Path>reg.exe unload "HKU\DefaultUser"</Path>
				</RunSynchronousCommand>
			</RunSynchronous>
		</component>
	</settings>
	<settings pass="auditSystem"></settings>
	<settings pass="auditUser"></settings>
	<settings pass="oobeSystem">
		<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="x86" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<OOBE>
				<ProtectYourPC>3</ProtectYourPC>
				<HideEULAPage>true</HideEULAPage>
				<HideWirelessSetupInOOBE>false</HideWirelessSetupInOOBE>
				<HideOnlineAccountScreens>true</HideOnlineAccountScreens>
			</OOBE>
			<FirstLogonCommands>
				<SynchronousCommand wcm:action="add">
					<Order>1</Order>
					<CommandLine>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\FirstLogon.ps1' -Raw | Invoke-Expression;"</CommandLine>
				</SynchronousCommand>
			</FirstLogonCommands>
		</component>
		<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="arm64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<OOBE>
				<ProtectYourPC>3</ProtectYourPC>
				<HideEULAPage>true</HideEULAPage>
				<HideWirelessSetupInOOBE>false</HideWirelessSetupInOOBE>
				<HideOnlineAccountScreens>true</HideOnlineAccountScreens>
			</OOBE>
			<FirstLogonCommands>
				<SynchronousCommand wcm:action="add">
					<Order>1</Order>
					<CommandLine>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\FirstLogon.ps1' -Raw | Invoke-Expression;"</CommandLine>
				</SynchronousCommand>
			</FirstLogonCommands>
		</component>
		<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<OOBE>
				<ProtectYourPC>3</ProtectYourPC>
				<HideEULAPage>true</HideEULAPage>
				<HideWirelessSetupInOOBE>false</HideWirelessSetupInOOBE>
				<HideOnlineAccountScreens>true</HideOnlineAccountScreens>
			</OOBE>
			<FirstLogonCommands>
				<SynchronousCommand wcm:action="add">
					<Order>1</Order>
					<CommandLine>powershell.exe -WindowStyle Normal -NoProfile -Command "Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\FirstLogon.ps1' -Raw | Invoke-Expression;"</CommandLine>
				</SynchronousCommand>
			</FirstLogonCommands>
		</component>
	</settings>
	<Extensions xmlns="https://schneegans.de/windows/unattend-generator/">
		<ExtractScript>
param(
    [xml] $Document
);

foreach( $file in $Document.unattend.Extensions.File ) {
    $path = [System.Environment]::ExpandEnvironmentVariables( $file.GetAttribute( 'path' ) );
    mkdir -Path( $path | Split-Path -Parent ) -ErrorAction 'SilentlyContinue';
    $encoding = switch( [System.IO.Path]::GetExtension( $path ) ) {
        { $_ -in '.ps1', '.xml' } { [System.Text.Encoding]::UTF8; }
        { $_ -in '.reg', '.vbs', '.js' } { [System.Text.UnicodeEncoding]::new( $false, $true ); }
        default { [System.Text.Encoding]::Default; }
    };
    $bytes = $encoding.GetPreamble() + $encoding.GetBytes( $file.InnerText.Trim() );
    [System.IO.File]::WriteAllBytes( $path, $bytes );
}
		</ExtractScript>
		<File path="C:\Windows\Setup\Scripts\RemovePackages.ps1">
$selectors = @(
	'Microsoft.Microsoft3DViewer';
	'Microsoft.BingSearch';
	'Clipchamp.Clipchamp';
	'Microsoft.WindowsAlarms';
	'Microsoft.549981C3F5F10';
	'Microsoft.Windows.DevHome';
	'MicrosoftCorporationII.MicrosoftFamily';
	'Microsoft.WindowsFeedbackHub';
	'Microsoft.Edge.GameAssist';
	'microsoft.windowscommunicationsapps';
	'Microsoft.WindowsMaps';
	'Microsoft.MixedReality.Portal';
	'Microsoft.BingNews';
	'Microsoft.MicrosoftOfficeHub';
	'Microsoft.Office.OneNote';
	'Microsoft.OutlookForWindows';
	'Microsoft.MSPaint';
	'Microsoft.People';
	'Microsoft.Windows.Photos';
	'Microsoft.PowerAutomateDesktop';
	'Microsoft.SkypeApp';
	'Microsoft.MicrosoftSolitaireCollection';
	'MicrosoftTeams';
	'MSTeams';
	'Microsoft.Todos';
	'Microsoft.Wallet';
	'Microsoft.BingWeather';
	'Microsoft.YourPhone';
	'Microsoft.ZuneMusic';
	'Microsoft.ZuneVideo';
);
$getCommand = {
  Get-AppxProvisionedPackage -Online;
};
$filterCommand = {
  $_.DisplayName -eq $selector;
};
$removeCommand = {
  [CmdletBinding()]
  param(
    [Parameter( Mandatory, ValueFromPipeline )]
    $InputObject
  );
  process {
    $InputObject | Remove-AppxProvisionedPackage -AllUsers -Online -ErrorAction 'Continue';
  }
};
$type = 'Package';
$logfile = 'C:\Windows\Setup\Scripts\RemovePackages.log';
&amp; {
	$installed = &amp; $getCommand;
	foreach( $selector in $selectors ) {
		$result = [ordered] @{
			Selector = $selector;
		};
		$found = $installed | Where-Object -FilterScript $filterCommand;
		if( $found ) {
			$result.Output = $found | &amp; $removeCommand;
			if( $? ) {
				$result.Message = "$type removed.";
			} else {
				$result.Message = "$type not removed.";
				$result.Error = $Error[0];
			}
		} else {
			$result.Message = "$type not installed.";
		}
		$result | ConvertTo-Json -Depth 3 -Compress;
	}
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; $logfile;
		</File>
		<File path="C:\Windows\Setup\Scripts\RemoveCapabilities.ps1">
$selectors = @(
	'Browser.InternetExplorer';
	'Microsoft.Windows.WordPad';
);
$getCommand = {
  Get-WindowsCapability -Online | Where-Object -Property 'State' -NotIn -Value @(
    'NotPresent';
    'Removed';
  );
};
$filterCommand = {
  ($_.Name -split '~')[0] -eq $selector;
};
$removeCommand = {
  [CmdletBinding()]
  param(
    [Parameter( Mandatory, ValueFromPipeline )]
    $InputObject
  );
  process {
    $InputObject | Remove-WindowsCapability -Online -ErrorAction 'Continue';
  }
};
$type = 'Capability';
$logfile = 'C:\Windows\Setup\Scripts\RemoveCapabilities.log';
&amp; {
	$installed = &amp; $getCommand;
	foreach( $selector in $selectors ) {
		$result = [ordered] @{
			Selector = $selector;
		};
		$found = $installed | Where-Object -FilterScript $filterCommand;
		if( $found ) {
			$result.Output = $found | &amp; $removeCommand;
			if( $? ) {
				$result.Message = "$type removed.";
			} else {
				$result.Message = "$type not removed.";
				$result.Error = $Error[0];
			}
		} else {
			$result.Message = "$type not installed.";
		}
		$result | ConvertTo-Json -Depth 3 -Compress;
	}
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; $logfile;
		</File>
		<File path="C:\Windows\Setup\Scripts\RemoveFeatures.ps1">
$selectors = @(
	'MicrosoftWindowsPowerShellV2Root';
);
$getCommand = {
  Get-WindowsOptionalFeature -Online | Where-Object -Property 'State' -NotIn -Value @(
    'Disabled';
    'DisabledWithPayloadRemoved';
  );
};
$filterCommand = {
  $_.FeatureName -eq $selector;
};
$removeCommand = {
  [CmdletBinding()]
  param(
    [Parameter( Mandatory, ValueFromPipeline )]
    $InputObject
  );
  process {
    $InputObject | Disable-WindowsOptionalFeature -Online -Remove -NoRestart -ErrorAction 'Continue';
  }
};
$type = 'Feature';
$logfile = 'C:\Windows\Setup\Scripts\RemoveFeatures.log';
&amp; {
	$installed = &amp; $getCommand;
	foreach( $selector in $selectors ) {
		$result = [ordered] @{
			Selector = $selector;
		};
		$found = $installed | Where-Object -FilterScript $filterCommand;
		if( $found ) {
			$result.Output = $found | &amp; $removeCommand;
			if( $? ) {
				$result.Message = "$type removed.";
			} else {
				$result.Message = "$type not removed.";
				$result.Error = $Error[0];
			}
		} else {
			$result.Message = "$type not installed.";
		}
		$result | ConvertTo-Json -Depth 3 -Compress;
	}
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; $logfile;
		</File>
		<File path="C:\Windows\Setup\Scripts\ShowAllTrayIcons.ps1">
if( [System.Environment]::OSVersion.Version.Build -lt 20000 ) {
	# Windows 10
	Set-ItemProperty -LiteralPath 'Registry::HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Explorer' -Name 'EnableAutoTray' -Type 'DWord' -Value 0 -Force;
} else {
	# Windows 11
	Register-ScheduledTask -TaskName 'ShowAllTrayIcons' -Xml $(
		Get-Content -LiteralPath "C:\Windows\Setup\Scripts\ShowAllTrayIcons.xml" -Raw;
	);
}
		</File>
		<File path="C:\Windows\Setup\Scripts\ShowAllTrayIcons.xml">
&lt;Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task"&gt;
	&lt;Triggers&gt;
		&lt;LogonTrigger&gt;
			&lt;Repetition&gt;
				&lt;Interval&gt;PT1M&lt;/Interval&gt;
				&lt;StopAtDurationEnd&gt;false&lt;/StopAtDurationEnd&gt;
			&lt;/Repetition&gt;
			&lt;Enabled&gt;true&lt;/Enabled&gt;
		&lt;/LogonTrigger&gt;
	&lt;/Triggers&gt;
	&lt;Principals&gt;
		&lt;Principal id="Author"&gt;
			&lt;GroupId&gt;S-1-5-32-545&lt;/GroupId&gt;
			&lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;
		&lt;/Principal&gt;
	&lt;/Principals&gt;
	&lt;Settings&gt;
		&lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;
		&lt;DisallowStartIfOnBatteries&gt;false&lt;/DisallowStartIfOnBatteries&gt;
		&lt;StopIfGoingOnBatteries&gt;false&lt;/StopIfGoingOnBatteries&gt;
		&lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;
		&lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;
		&lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;
		&lt;IdleSettings&gt;
			&lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;
			&lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;
		&lt;/IdleSettings&gt;
		&lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;
		&lt;Enabled&gt;true&lt;/Enabled&gt;
		&lt;Hidden&gt;false&lt;/Hidden&gt;
		&lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;
		&lt;WakeToRun&gt;false&lt;/WakeToRun&gt;
		&lt;ExecutionTimeLimit&gt;PT72H&lt;/ExecutionTimeLimit&gt;
		&lt;Priority&gt;7&lt;/Priority&gt;
	&lt;/Settings&gt;
	&lt;Actions Context="Author"&gt;
		&lt;Exec&gt;
			&lt;Command&gt;C:\Windows\System32\wscript.exe&lt;/Command&gt;
			&lt;Arguments&gt;C:\Windows\Setup\Scripts\ShowAllTrayIcons.vbs&lt;/Arguments&gt;
		&lt;/Exec&gt;
	&lt;/Actions&gt;
&lt;/Task&gt;
		</File>
		<File path="C:\Windows\Setup\Scripts\ShowAllTrayIcons.vbs">
HKCU = &amp;H80000001
key = "Control Panel\NotifyIconSettings"
Set reg = GetObject("winmgmts://./root/default:StdRegProv")
If reg.EnumKey(HKCU, key, names) = 0 Then
	If Not IsNull(names) Then
		For Each name In names
			reg.SetDWORDValue HKCU, key + "\" + name, "IsPromoted", 1
		Next
	End If
End If
		</File>
		<File path="C:\Windows\Setup\Scripts\MoveActiveHours.vbs">
HKLM = &amp;H80000002
key = "SOFTWARE\Microsoft\WindowsUpdate\UX\Settings"
Set reg = GetObject("winmgmts://./root/default:StdRegProv")
current = Hour(Now)
reg.SetDWORDValue HKLM, key, "ActiveHoursStart", ( current + 23 ) Mod 24
reg.SetDWORDValue HKLM, key, "ActiveHoursEnd", ( current + 11 ) Mod 24
reg.SetDWORDValue HKLM, key, "SmartActiveHoursState", 2
		</File>
		<File path="C:\Windows\Setup\Scripts\MoveActiveHours.xml">
&lt;Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task"&gt;
	&lt;Triggers&gt;
		&lt;BootTrigger&gt;
			&lt;Repetition&gt;
				&lt;Interval&gt;PT4H&lt;/Interval&gt;
				&lt;StopAtDurationEnd&gt;false&lt;/StopAtDurationEnd&gt;
			&lt;/Repetition&gt;
			&lt;Enabled&gt;true&lt;/Enabled&gt;
		&lt;/BootTrigger&gt;
		&lt;RegistrationTrigger&gt;
			&lt;Repetition&gt;
				&lt;Interval&gt;PT4H&lt;/Interval&gt;
				&lt;StopAtDurationEnd&gt;false&lt;/StopAtDurationEnd&gt;
			&lt;/Repetition&gt;
			&lt;Enabled&gt;true&lt;/Enabled&gt;
		&lt;/RegistrationTrigger&gt;
	&lt;/Triggers&gt;
	&lt;Principals&gt;
		&lt;Principal id="Author"&gt;
			&lt;UserId&gt;S-1-5-19&lt;/UserId&gt;
			&lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;
		&lt;/Principal&gt;
	&lt;/Principals&gt;
	&lt;Settings&gt;
		&lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;
		&lt;DisallowStartIfOnBatteries&gt;false&lt;/DisallowStartIfOnBatteries&gt;
		&lt;StopIfGoingOnBatteries&gt;false&lt;/StopIfGoingOnBatteries&gt;
		&lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;
		&lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;
		&lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;
		&lt;IdleSettings&gt;
			&lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;
			&lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;
		&lt;/IdleSettings&gt;
		&lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;
		&lt;Enabled&gt;true&lt;/Enabled&gt;
		&lt;Hidden&gt;false&lt;/Hidden&gt;
		&lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;
		&lt;WakeToRun&gt;false&lt;/WakeToRun&gt;
		&lt;ExecutionTimeLimit&gt;PT72H&lt;/ExecutionTimeLimit&gt;
		&lt;Priority&gt;7&lt;/Priority&gt;
	&lt;/Settings&gt;
	&lt;Actions Context="Author"&gt;
		&lt;Exec&gt;
			&lt;Command&gt;C:\Windows\System32\wscript.exe&lt;/Command&gt;
			&lt;Arguments&gt;C:\Windows\Setup\Scripts\MoveActiveHours.vbs&lt;/Arguments&gt;
		&lt;/Exec&gt;
	&lt;/Actions&gt;
&lt;/Task&gt;
		</File>
		<File path="C:\Windows\Setup\Scripts\MakeEdgeUninstallable.ps1">
$ErrorActionPreference = 'Stop';
&amp; {
	try {
		$params = @{
			LiteralPath = 'C:\Windows\System32\IntegratedServicesRegionPolicySet.json';
			Encoding = 'Utf8';
		};
		$o = Get-Content @params | ConvertFrom-Json;
		$o.policies | ForEach-Object -Process {
			if( $_.guid -eq '{1bca278a-5d11-4acf-ad2f-f9ab6d7f93a6}' ) {
				$_.defaultState = 'enabled';
			}
		};
		$o | ConvertTo-Json -Depth 9 | Out-File @params;
	} catch {
		$_;
	}
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; 'C:\Windows\Setup\Scripts\MakeEdgeUninstallable.log';
		</File>
		<File path="C:\Windows\Setup\Scripts\SetStartPins.ps1">
$json = '{"pinnedList":[]}';
if( [System.Environment]::OSVersion.Version.Build -lt 20000 ) {
	return;
}
$key = 'Registry::HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\Start';
New-Item -Path $key -ItemType 'Directory' -ErrorAction 'SilentlyContinue';
Set-ItemProperty -LiteralPath $key -Name 'ConfigureStartPins' -Value $json -Type 'String';
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-01.cmd">
powercfg /H OFF
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-02.reg">
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CloudContent]
"DisableCloudOptimizedContent"=dword:00000001
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-03.cmd">
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableSR " /t "REG_DWORD" /d "1" /f
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableSR " /t "REG_DWORD" /d "1" /f
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-04.cmd">
DISM.exe /Online /Set-ReservedStorageState /State:Disabled
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-05.cmd">
@echo off
cls

set x86="%SYSTEMROOT%\System32\OneDriveSetup.exe"
set x64="%SYSTEMROOT%\SysWOW64\OneDriveSetup.exe"

echo Closing OneDrive process.
echo.
taskkill /f /im OneDrive.exe &gt; NUL 2&gt;&amp;1
ping 127.0.0.1 -n 5 &gt; NUL 2&gt;&amp;1

echo Uninstalling OneDrive.
echo.
if exist %x64% (
%x64% /uninstall
) else (
%x86% /uninstall
)
ping 127.0.0.1 -n 5 &gt; NUL 2&gt;&amp;1

echo Removing OneDrive leftovers.
echo.
rd "%USERPROFILE%\OneDrive" /Q /S &gt; NUL 2&gt;&amp;1
rd "C:\OneDriveTemp" /Q /S &gt; NUL 2&gt;&amp;1
rd "%LOCALAPPDATA%\Microsoft\OneDrive" /Q /S &gt; NUL 2&gt;&amp;1
rd "%PROGRAMDATA%\Microsoft OneDrive" /Q /S &gt; NUL 2&gt;&amp;1

echo Removing OneDrive from the Explorer Side Panel.
echo.
REG DELETE "HKEY_CLASSES_ROOT\CLSID\{018D5C66-4533-4307-9B53-224DE2ED1FE6}" /f &gt; NUL 2&gt;&amp;1
REG DELETE "HKEY_CLASSES_ROOT\Wow6432Node\CLSID\{018D5C66-4533-4307-9B53-224DE2ED1FE6}" /f &gt; NUL 2&gt;&amp;1

exit
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-06.cmd">
fsutil behavior set disable8dot3 1
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-07.ps1">
# This script will install Winget from within the Windows Sandbox
# It fetches the necessary files and dependencies from Microsoft's winget-cli, and installs them

# Author: ThioJoe
# Repo Url: https://github.com/ThioJoe/Windows-Sandbox-Tools
# Last Updated: August 4, 2025

param(
        [switch]$removeMsStoreAsSource = $false # If switch is included, it will remove the 'msstore' source after installing winget, which doesn't work with Sandbox, unless the Microsoft Store is also installed
    )

function Get-LatestRelease {
    param(
        [string]$repoOwner = 'microsoft',
        [string]$repoName = 'winget-cli'
    )
    try {
        $releasesUrl = "https://api.github.com/repos/$repoOwner/$repoName/releases"
        $releases = Invoke-RestMethod -Uri $releasesUrl -UseBasicParsing
    } catch {
        Write-Error "Failed to fetch releases from GitHub API: $($_.Exception.Message)"
        return $null
    }

	if (-not $releases) { Write-Error "No releases found for $repoOwner/$repoName."; return $null; }

    # Pick the top entry once sorted by published_at descending
    $latestRelease = $releases | Sort-Object -Property published_at -Descending | Select-Object -First 1
    return $latestRelease
}

function Get-AssetUrl {
    param(
        [Parameter(Mandatory=$true)]
        $release,
        [Parameter(Mandatory=$true)]
        [string]$assetName
    )

    if ($release.assets -and $release.assets.Count -gt 0) {
        $asset = $release.assets | Where-Object { $_.name -eq $assetName }
        if ($asset) {
            return $asset.browser_download_url
        }
    }
    return $null
}

function Install-WingetDependencies {
    param([string]$depsFolder)

    # Look for DesktopAppInstaller_Dependencies.json to determine explicit install order
    $jsonFile = Join-Path $depsFolder "DesktopAppInstaller_Dependencies.json"
    if (Test-Path $jsonFile) {
        Write-Host "Installing dependencies based on DesktopAppInstaller_Dependencies.json"
        $jsonContent = Get-Content $jsonFile -Raw | ConvertFrom-Json
        $dependencies = $jsonContent.Dependencies

        foreach ($dep in $dependencies) {
            # For example: "Microsoft.VCLibs.140.00.UWPDesktop" + "14.0.33728.0"
            $matchingFiles = Get-ChildItem -Path $depsFolder -Filter *.appx -Recurse |
                Where-Object { $_.Name -like "*$($dep.Name)*" -and $_.Name -like "*$($dep.Version)*" }

            foreach ($file in $matchingFiles) {
                Write-Host "Installing dependency: $($file.Name)"
                Add-AppxPackage -Path $file.FullName
            }
        }
    }
    else {
        # If the JSON doesn't exist, install all .appx in the folder
        Write-Warning "No DesktopAppInstaller_Dependencies.json found, installing all .appx in $depsFolder"
        foreach ($appxFile in Get-ChildItem $depsFolder -Filter *.appx -Recurse) {
            Write-Host "Installing: $($appxFile.Name)"
            Add-AppxPackage -Path $appxFile.FullName
        }
    }
}

# Prevents progress bar from showing (often speeds downloads)
$ProgressPreference = 'SilentlyContinue'

$downloadPath = Join-Path $env:USERPROFILE "Downloads"
$latestRelease = Get-LatestRelease
if (-not $latestRelease) { Write-Error "Could not retrieve the latest release. Exiting."; return; }

$latestTag = $latestRelease.tag_name
Write-Host "Latest winget version tag is: $latestTag"

# Download the MSIX bundle
$msixName = "Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle"
$msixUrl = Get-AssetUrl -release $latestRelease -assetName $msixName
if (-not $msixUrl) { Write-Error "Could not find $msixName in the latest release assets."; return; }

Write-Host "Downloading $msixName..."
$msixPath = Join-Path $downloadPath $msixName
Invoke-WebRequest -Uri $msixUrl -OutFile $msixPath

# Figure out the OS architecture using environment variable
$procArch = $env:PROCESSOR_ARCHITECTURE
switch -Wildcard ($procArch) {
    "AMD64"   { $arch = "x64" }
    "x86"     { $arch = "x86" }
    "*ARM64*" { $arch = "arm64" }
    "*ARM*"   { $arch = "arm" }
    default {
        $arch = "x64"
        Write-Warning "Unrecognized architecture: $procArch. Defaulting to x64."
    }
}

# Download the dependencies zip
$depsZipName = "DesktopAppInstaller_Dependencies.zip"
$depsZipUrl  = Get-AssetUrl -release $latestRelease -assetName $depsZipName

# We'll expand to a base 'Dependencies' folder
$topDepsFolder = Join-Path $downloadPath "Dependencies"
# Then pick the sub-folder for the architecture
$depsFolder    = Join-Path $topDepsFolder $arch

if ($depsZipUrl) {
    Write-Host "Downloading $depsZipName..."
    $depsZipPath = Join-Path $downloadPath $depsZipName
    Invoke-WebRequest -Uri $depsZipUrl -OutFile $depsZipPath

    # Remove existing Dependencies folder and expand the zip
    if (Test-Path $topDepsFolder) { Remove-Item -Path $topDepsFolder -Recurse -Force }

    Expand-Archive -LiteralPath $depsZipPath -DestinationPath $topDepsFolder -Force
}
else { Write-Warning "No $depsZipName found in $latestTag, skipping dependency download."; }

# Restore progress preference
$ProgressPreference = 'Continue'

# If dependencies exist for this architecture, install them
if (Test-Path $depsFolder) {
    Install-WingetDependencies -depsFolder $depsFolder
} else {
    Write-Warning "No architecture-specific dependencies found at $depsFolder"
}

# Finally, install the winget MSIX bundle
Write-Host "Installing $msixName..."
Add-AppxPackage -Path $msixPath

# Remove msstore source if set to do so
if ($removeMsStoreAsSource.IsPresent) {
    Write-Host "Attempting to remove 'msstore' source from winget..."
    try {
        winget source remove -n msstore --ignore-warnings
    } catch {
        Write-Warning "An error occurred while trying to execute 'winget source remove msstore': $($_.Exception.Message)"
    }
} else {
    # Automatically accept source agreements to avoid prompts. Mostly applies to msstore.
    winget list --accept-source-agreements | Out-Null
}
Exit
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-08.cmd">
@echo off
setlocal enabledelayedexpansion

echo Checking for installed applications...

REM Check if Brave is installed
set "BraveInstalled=false"
if exist "%ProgramFiles%\BraveSoftware\Brave-Browser\Application\brave.exe" (
    set "BraveInstalled=true"
    echo Brave is already installed.
)
if exist "%ProgramFiles(x86)%\BraveSoftware\Brave-Browser\Application\brave.exe" (
    set "BraveInstalled=true"
    echo Brave is already installed.
)

REM Check if IrfanView is installed
set "IrfanViewInstalled=false"
if exist "%ProgramFiles%\IrfanView\i_view*.exe" (
    set "IrfanViewInstalled=true"
    echo IrfanView is already installed.
)
if exist "%ProgramFiles(x86)%\IrfanView\i_view*.exe" (
    set "IrfanViewInstalled=true"
    echo IrfanView is already installed.
)

REM Check for ISO with WinApps directory
set "ISOFound=false"
set "WinAppsDir="

REM Create a temporary PowerShell script to find ISO drives
echo $isoDrives = Get-Volume ^| Where-Object { $_.DriveType -eq 'CD-ROM' -and $_.OperationalStatus -eq 'OK' } ^| Select-Object -ExpandProperty DriveLetter &gt; "%TEMP%\find_iso.ps1"
echo foreach($drive in $isoDrives) { &gt;&gt; "%TEMP%\find_iso.ps1"
echo   if (Test-Path "$drive`:\WinApps") { &gt;&gt; "%TEMP%\find_iso.ps1"
echo     Write-Host "$drive" &gt;&gt; "%TEMP%\find_iso.ps1"
echo     exit &gt;&gt; "%TEMP%\find_iso.ps1"
echo   } &gt;&gt; "%TEMP%\find_iso.ps1"
echo } &gt;&gt; "%TEMP%\find_iso.ps1"

REM Run the PowerShell script and capture its output
for /f %%i in ('powershell -ExecutionPolicy Bypass -File "%TEMP%\find_iso.ps1"') do (
    set "IsoDrive=%%i"
    set "ISOFound=true"
    set "WinAppsDir=%%i:\WinApps"
    echo Found WinApps directory on drive %%i:
)

REM Clean up the temporary script
del "%TEMP%\find_iso.ps1" &gt; nul 2&gt;&amp;1

REM Install Brave if not already installed
if "%BraveInstalled%"=="false" (
    echo Installing Brave Browser...

    if "%ISOFound%"=="true" (
        if exist "%WinAppsDir%\brave_silent.exe" (
            echo Installing Brave from ISO...
            start /wait "" "%WinAppsDir%\brave_silent.exe"
            echo Brave installation from ISO completed.
        ) else (
            echo Brave installer not found on ISO, installing from online source...
            winget install Brave.Brave --accept-package-agreements --accept-source-agreements
        )
    ) else (
        echo Installing Brave from online source...
        winget install Brave.Brave --accept-package-agreements --accept-source-agreements
    )
) else (
    echo Skipping Brave installation as it's already installed.
)

REM Install IrfanView if not already installed
if "%IrfanViewInstalled%"=="false" (
    echo Installing IrfanView...

    if "%ISOFound%"=="true" (
        if exist "%WinAppsDir%\iview_setup.exe" (
            echo Installing IrfanView from ISO...
            start /wait "" "%WinAppsDir%\iview_setup.exe" /silent
            echo IrfanView installation from ISO completed.
        ) else (
            echo IrfanView installer not found on ISO, installing from online source...
            winget install IrfanSkiljan.IrfanView --accept-package-agreements --accept-source-agreements
        )
    ) else (
        echo Installing IrfanView from online source...
        winget install IrfanSkiljan.IrfanView --accept-package-agreements --accept-source-agreements
    )
) else (
    echo Skipping IrfanView installation as it's already installed.
)

echo Installation process completed.
exit /b 0
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-09.ps1">
foreach( $drive in [System.IO.DriveInfo]::GetDrives() ) {
    if( $found = Join-Path -Path $drive.RootDirectory -ChildPath 'sources\sxs' -Resolve -ErrorAction 'SilentlyContinue' ) {
        Enable-WindowsOptionalFeature -Online -FeatureName 'NetFx3' -Source $found -NoRestart;
        return;
    }
}
'Cannot find any files that match pattern.' | Write-Warning;
		</File>
		<File path="C:\Windows\Setup\Scripts\unattend-0a.ps1">
param (
    [switch]$Verbose,
    [switch]$OfflineMode
)

# Check Internet connectivity with a 10-second timeout
Write-Output "Checking for Internet Connectivity by pinging Google DNS 8.8.8.8 (10 sec timeout)"
$pp = $ProgressPreference
$ProgressPreference = 'SilentlyContinue'

# Use Start-Job to implement timeout for connectivity check
$internetAvailable = $false
try {
    $job = Start-Job -ScriptBlock {
        param($ProgressPref)
        $ProgressPreference = $ProgressPref
        test-netconnection -ComputerName 8.8.8.8 -InformationLevel Quiet
    } -ArgumentList $ProgressPreference

    # Wait up to 10 seconds for the job to complete
    if (Wait-Job -Job $job -Timeout 10) {
        $internetAvailable = Receive-Job -Job $job
        Write-Output "Internet Connectivity Check Completed!"
    } else {
        Write-Output "Internet Connectivity Check timed out after 10 seconds."
        $internetAvailable = $false
    }

    # Clean up the job
    Remove-Job -Job $job -Force -ErrorAction SilentlyContinue
} catch {
    Write-Output "Internet Connectivity Check failed with error: $_"
    $internetAvailable = $false
}

$ProgressPreference = $pp

&lt;#
.SYNOPSIS
This PowerShell script ensures it is run with administrator privileges, then installs the necessary Visual C++ Redistributables and DirectX 9 End-User Runtime silently. It provides progress updates throughout the installation process and handles errors gracefully.

.DESCRIPTION
This script performs the following tasks:
- Checks if it is run with administrator privileges and relaunches with elevated permissions if necessary.
- Checks for offline packages in the WinApps directory at the root of the ISO or in the script directory before attempting to download.
- Downloads and installs the latest Visual C++ Redistributables from a GitLab repository if offline packages don't exist.
- Downloads and installs the DirectX 9 End-User Runtime from Microsoft's official website if offline packages don't exist.
- Provides verbose logging for detailed output, including the URLs being accessed, the files being downloaded, and the installation progress.
- Handles errors gracefully by catching exceptions and providing meaningful error messages.
- Waits for user input before exiting if an error occurs or at the end of the script, ensuring that the user is aware of the script's completion or any issues that occurred.

.PARAMETER Verbose
Enables verbose logging for detailed output. When this switch is used, the script will provide additional information about its progress and actions.

.PARAMETER OfflineMode
Forces the script to use only offline packages and skip internet connectivity checks.

.EXAMPLE
.\Install-VCRedistAndDirectX.ps1 -Verbose
Runs the script with verbose logging enabled, providing detailed output about the script's progress and actions.

.EXAMPLE
.\Install-VCRedistAndDirectX.ps1 -OfflineMode
Runs the script in offline mode, using only locally available packages without checking for internet connectivity.

.EXAMPLE
# Running the script from the Internet
irm https://gist.githubusercontent.com/emilwojcik93/ef790a6b12c8e9358bbc52ed76fb495c/raw/Install-VCRedistAndDirectX.ps1 | iex
Downloads and runs the script directly from the provided URL, ensuring that the latest version is used.

.LINK
https://gist.github.com/emilwojcik93/ef790a6b12c8e9358bbc52ed76fb495c
#&gt;


if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Output "This script needs to be run as Administrator. Attempting to relaunch."
    $argList = @()

    $PSBoundParameters.GetEnumerator() | ForEach-Object {
        $argList += if ($_.Value -is [switch] -and $_.Value) {
            "-$($_.Key)"
        } elseif ($_.Value) {
            "-$($_.Key) `"$($_.Value)`""
        }
    }


    $script = if ($PSCommandPath) {
        "&amp; { &amp; `"$($PSCommandPath)`" ${argList} }"
    } else {
        "&amp;([ScriptBlock]::Create((irm https://gist.githubusercontent.com/emilwojcik93/ef790a6b12c8e9358bbc52ed76fb495c/raw/Install-VCRedistAndDirectX.ps1))) ${argList}"
    }

    $powershellcmd = if (Get-Command pwsh -ErrorAction SilentlyContinue) { "pwsh" } else { "powershell" }
    $processCmd = if (Get-Command wt.exe -ErrorAction SilentlyContinue) { "wt.exe" } else { $powershellcmd }

    Start-Process $processCmd -ArgumentList "$powershellcmd -ExecutionPolicy Bypass -NoProfile -Command $script" -Verb RunAs

    break
}

# Function to check if the parent process is explorer.exe
function Is-StartedByExplorer {
    $parentProcess = Get-WmiObject Win32_Process -Filter "ProcessId=$((Get-WmiObject Win32_Process -Filter "ProcessId=$PID").ParentProcessId)"
    return $parentProcess.Name -eq "explorer.exe"
}

# Function to check if the session is likely to close at the end of the script
function Is-SessionLikelyToClose {
    $commandLineArgs = [Environment]::GetCommandLineArgs()
    return ($commandLineArgs -contains "-NoProfile")
}

# Function to check if offline packages exist
function Test-OfflinePackages {
    param (
        [string]$PackageName
    )

    # First, check in the WinApps directory at the root of the ISO
    # Try to find the ISO drive letter
    $isoDrives = Get-Volume | Where-Object { $_.DriveType -eq 'CD-ROM' -and $_.OperationalStatus -eq 'OK' } | Select-Object -ExpandProperty DriveLetter
    $packagePath = $null

    # Check each potential ISO drive for the WinApps directory
    foreach ($driveLetter in $isoDrives) {
        $winAppsPath = "${driveLetter}:\WinApps"
        Write-Verbose "Checking for WinApps directory in drive ${driveLetter}: $winAppsPath"

        if (Test-Path $winAppsPath) {
            Write-Verbose "Found WinApps directory in drive ${driveLetter}"

            switch ($PackageName) {
                "VCRedist" {
                    $vcRedistFile = Join-Path $winAppsPath "VisualCppRedist_AIO_x86_x64.exe"
                    if (Test-Path $vcRedistFile) {
                        Write-Verbose "Found VCRedist package in ISO WinApps directory"
                        return $true, $vcRedistFile
                    }
                }
                "DirectX" {
                    $directXFile = Join-Path $winAppsPath "DirectX_Redist_Repack_x86_x64.exe"
                    if (Test-Path $directXFile) {
                        Write-Verbose "Found DirectX package in ISO WinApps directory"
                        return $true, $directXFile
                    }
                }
            }
        }
    }

    # If not found in ISO, fallback to script directory
    $scriptDirectory = if ($PSCommandPath) {
        Split-Path -Parent $PSCommandPath
    } else {
        $PWD.Path
    }

    $offlineDirectory = Join-Path $scriptDirectory "offline-packages"

    switch ($PackageName) {
        "VCRedist" {
            $vcRedistFile = Join-Path $offlineDirectory "VisualCppRedist_AIO_x86_x64.exe"
            return (Test-Path $vcRedistFile), $vcRedistFile
        }
        "DirectX" {
            $directXFile = Join-Path $offlineDirectory "DirectX_Redist_Repack_x86_x64.exe"
            return (Test-Path $directXFile), $directXFile
        }
    }

    return $false, $null
}

function Get-LatestReleaseUrl {
    param (
        [string]$RepoUrl,
        [string]$FilePattern
    )

    Write-Verbose "Fetching the latest release URL from $RepoUrl..."
    $apiUrl = "$RepoUrl/releases/latest"
    try {
        $response = Invoke-RestMethod -Uri $apiUrl -UseBasicParsing
    } catch {
        Write-Error "Failed to access the URL: $RepoUrl"
        return $null
    }

    $latestAsset = $response.assets | Where-Object { $_.name -like $FilePattern }
    if ($null -eq $latestAsset) {
        Write-Error "No file matching the pattern '$FilePattern' found in the latest release."
        return $null
    }

    $downloadUrl = $latestAsset.browser_download_url
    Write-Verbose "Latest release URL: $downloadUrl"
    return $downloadUrl
}

function Download {
    param (
        [string]$Url,
        [string]$Destination,
        [string]$FileType
    )

    Write-Verbose "Download called with Url: $Url, Destination: $Destination, FileType: $FileType"

    if (Test-Path $Destination) {
        Write-Verbose "Removing existing directory: $Destination"
        Remove-Item -Path $Destination -Recurse -Force -ErrorAction SilentlyContinue
    }
    Write-Verbose "Creating directory: $Destination"
    New-Item -ItemType Directory -Force -Path $Destination

    $fileName = [System.IO.Path]::GetFileName($Url)
    $filePath = "$Destination\$fileName"
    Write-Verbose "Downloading file from URL: $Url to $filePath"
    try {
        Invoke-WebRequest -Uri $Url -OutFile $filePath -ErrorAction Stop
    } catch {
        Write-Error "Failed to download the file from URL: $Url"
        return $null
    }

    if (-not (Test-Path $filePath)) {
        Write-Error "Downloaded file not found: $filePath"
        return $null
    }

    Write-Verbose "Downloading completed for file: $filePath"
}

function Install-VCRedist {
    Write-Output "Installing Visual C++ Redistributables..."

    # Check for offline package
    $offlineExists, $offlinePath = Test-OfflinePackages -PackageName "VCRedist"
    $vcRedistInstaller = $null

    if ($offlineExists) {
        Write-Verbose "Found offline VCRedist package: $offlinePath"
        $vcRedistInstaller = $offlinePath
    } else {
        # If Internet check timed out or failed, try to find the installer in WinApps folder on ISO
        if (-not $internetAvailable -or $OfflineMode) {
            # Check for ISO WinApps directory using the same approach as Install-BraveAndIrfanView.cmd
            Write-Output "No internet connection or offline mode enabled, checking ISO for VCRedist package..."

            # Create a similar approach to the CMD script with clearly defined variables
            $ISOFound = $false
            $WinAppsDir = $null

            # Create a temporary script to find ISO with WinApps directory
            $tempScriptPath = Join-Path $env:TEMP "find_iso.ps1"
            @"
`$isoDrives = Get-Volume | Where-Object { `$_.DriveType -eq 'CD-ROM' -and `$_.OperationalStatus -eq 'OK' } | Select-Object -ExpandProperty DriveLetter
foreach(`$drive in `$isoDrives) {
  if (Test-Path "`${drive}:\WinApps") {
    Write-Host "`$drive"
    exit
  }
}
"@ | Out-File -FilePath $tempScriptPath -Encoding utf8

            try {
                # Execute the temporary script to find the ISO
                $isoDrive = &amp; powershell -ExecutionPolicy Bypass -File $tempScriptPath

                if ($isoDrive) {
                    $ISOFound = $true
                    $WinAppsDir = "${isoDrive}:\WinApps"
                    Write-Output "Found WinApps directory on drive ${isoDrive}:"
                }
            }
            finally {
                # Clean up the temporary script
                if (Test-Path $tempScriptPath) {
                    Remove-Item -Path $tempScriptPath -Force
                }
            }

            # Check for VCRedist in the WinApps directory
            if ($ISOFound) {
                $vcRedistPath = Join-Path $WinAppsDir "VisualCppRedist_AIO_x86_x64.exe"
                if (Test-Path $vcRedistPath) {
                    Write-Output "Found VCRedist package in ISO WinApps directory: $vcRedistPath"
                    $vcRedistInstaller = $vcRedistPath
                } else {
                    throw "VCRedist package not found in WinApps directory on ISO."
                }
            } else {
                throw "No internet connection available and no ISO with WinApps directory found."
            }
        } else {
            # If we have internet, try downloading as usual
            Write-Output "Downloading Visual C++ Redistributables..."
            $vcRedistUrl = "https://gitlab.com/-/project/76069787/uploads/4431f3448fa76633cfd4983142f81952/VisualCppRedist_AIO_x86_x64.exe"
            if ($null -eq $vcRedistUrl) {
                throw "Failed to get the latest Visual C++ Redistributables URL."
            }

            Write-Verbose "Visual C++ Redistributables URL: $vcRedistUrl"

            $tempDir = "$env:TEMP\VcRedist"
            $result = Download -Url "$vcRedistUrl" -Destination "$tempDir" -FileType "exe"
            if ($null -eq $result) {
                throw "Failed to download Visual C++ Redistributables."
            }

            $vcRedistInstaller = "$tempDir\VisualCppRedist_AIO_x86_x64.exe"
        }
    }

    if (-not (Test-Path $vcRedistInstaller)) {
        throw "Installer file not found: $vcRedistInstaller"
    }

    Write-Verbose "Running installer: $vcRedistInstaller with arguments: /ai /gm2"
    # Create a ProcessStartInfo object to set more detailed parameters
    $processInfo = New-Object System.Diagnostics.ProcessStartInfo
    $processInfo.FileName = $vcRedistInstaller
    $processInfo.Arguments = "/ai /gm2"
    $processInfo.UseShellExecute = $true
    $processInfo.Verb = "runas"

    # Start the process
    $process = [System.Diagnostics.Process]::Start($processInfo)
    $process.WaitForExit()

    Write-Output "Visual C++ Redistributables installation completed."
}

function Install-DirectX {
    Write-Output "Installing DirectX 9 End-User Runtime..."
    $ErrorActionPreference = 'Stop'

    # Check for offline package
    $offlineExists, $offlinePath = Test-OfflinePackages -PackageName "DirectX"
    $directxInstaller = $null
    $tempDir = "$env:TEMP\directx"

    if ($offlineExists) {
        Write-Verbose "Found offline DirectX package: $offlinePath"
        $directxInstaller = $offlinePath

        # For offline packages, we use the "/ai /gm2" arguments directly
        Write-Verbose "Installing offline DirectX package with arguments: /ai /gm2"
        # Create a ProcessStartInfo object to set more detailed parameters
        $processInfo = New-Object System.Diagnostics.ProcessStartInfo
        $processInfo.FileName = $directxInstaller
        $processInfo.Arguments = "/ai /gm2"
        $processInfo.UseShellExecute = $true
        $processInfo.Verb = "runas"

        # Start the process
        $process = [System.Diagnostics.Process]::Start($processInfo)
        $process.WaitForExit()
        Write-Output "DirectX installation from offline package completed."
        return
    } else {
        # If Internet check timed out or failed, try to find the installer in WinApps folder on ISO
        if (-not $internetAvailable -or $OfflineMode) {
            # Check for ISO WinApps directory using the same approach as Install-BraveAndIrfanView.cmd
            Write-Output "No internet connection or offline mode enabled, checking ISO for DirectX package..."

            # Create a similar approach to the CMD script with clearly defined variables
            $ISOFound = $false
            $WinAppsDir = $null

            # Create a temporary script to find ISO with WinApps directory
            $tempScriptPath = Join-Path $env:TEMP "find_iso.ps1"
            @"
`$isoDrives = Get-Volume | Where-Object { `$_.DriveType -eq 'CD-ROM' -and `$_.OperationalStatus -eq 'OK' } | Select-Object -ExpandProperty DriveLetter
foreach(`$drive in `$isoDrives) {
  if (Test-Path "`${drive}:\WinApps") {
    Write-Host "`$drive"
    exit
  }
}
"@ | Out-File -FilePath $tempScriptPath -Encoding utf8

            try {
                # Execute the temporary script to find the ISO
                $isoDrive = &amp; powershell -ExecutionPolicy Bypass -File $tempScriptPath

                if ($isoDrive) {
                    $ISOFound = $true
                    $WinAppsDir = "${isoDrive}:\WinApps"
                    Write-Output "Found WinApps directory on drive ${isoDrive}:"
                }
            }
            finally {
                # Clean up the temporary script
                if (Test-Path $tempScriptPath) {
                    Remove-Item -Path $tempScriptPath -Force
                }
            }

            # Check for DirectX in the WinApps directory
            if ($ISOFound) {
                $directxPath = Join-Path $WinAppsDir "DirectX_Redist_Repack_x86_x64.exe"
                if (Test-Path $directxPath) {
                    Write-Output "Found DirectX package in ISO WinApps directory: $directxPath"
                    $directxInstaller = $directxPath

                    # For offline packages from ISO, we use the "/ai /gm2" arguments directly
                    Write-Verbose "Installing DirectX package from ISO with arguments: /ai /gm2"
                    # Create a ProcessStartInfo object to set more detailed parameters
                    $processInfo = New-Object System.Diagnostics.ProcessStartInfo
                    $processInfo.FileName = $directxInstaller
                    $processInfo.Arguments = "/ai /gm2"
                    $processInfo.UseShellExecute = $true
                    $processInfo.Verb = "runas"

                    # Start the process
                    $process = [System.Diagnostics.Process]::Start($processInfo)
                    $process.WaitForExit()
                    Write-Output "DirectX installation from ISO completed."
                    return
                } else {
                    throw "DirectX package not found in WinApps directory on ISO."
                }
            } else {
                throw "No internet connection available and no ISO with WinApps directory found."
            }
        }

        Write-Output "Downloading DirectX 9 End-User Runtime..."
        # Ensure the temporary directory is clean
        if (Test-Path $tempDir) {
            Write-Verbose "Removing existing directory: $tempDir"
            Remove-Item -Path $tempDir -Recurse -Force -ErrorAction SilentlyContinue
        }
        Write-Verbose "Creating directory: $tempDir"
        New-Item -ItemType Directory -Force -Path $tempDir &gt; $null

        $directxUrl = "https://download.microsoft.com/download/8/4/A/84A35BF1-DAFE-4AE8-82AF-AD2AE20B6B14/directx_Jun2010_redist.exe"
        $directxInstaller = "$tempDir\directx_Jun2010_redist.exe"
        Write-Verbose "Downloading DirectX from URL: $directxUrl to $directxInstaller"
        Invoke-WebRequest -Uri $directxUrl -OutFile $directxInstaller

        if (-not (Test-Path $directxInstaller)) {
            throw "DirectX installer not found: $directxInstaller"
        }

        Write-Verbose "Extracting DirectX 9 End-User Runtime..."
        # Create a ProcessStartInfo object for extraction
        $extractInfo = New-Object System.Diagnostics.ProcessStartInfo
        $extractInfo.FileName = $directxInstaller
        $extractInfo.Arguments = "/Q /T:$tempDir"
        $extractInfo.UseShellExecute = $true
        $extractInfo.Verb = "runas"

        # Start the extraction process
        $extractProcess = [System.Diagnostics.Process]::Start($extractInfo)
        $extractProcess.WaitForExit()

        $dxSetup = "$tempDir\DXSETUP.exe"
        if (-not (Test-Path $dxSetup)) {
            throw "DXSETUP.exe not found in $tempDir"
        }

        Write-Verbose "Installing DirectX 9 End-User Runtime from $dxSetup with arguments: /silent"
        # Create a ProcessStartInfo object for installation
        $installInfo = New-Object System.Diagnostics.ProcessStartInfo
        $installInfo.FileName = $dxSetup
        $installInfo.Arguments = "/silent"
        $installInfo.UseShellExecute = $true
        $installInfo.Verb = "runas"

        # Start the installation process
        $installProcess = [System.Diagnostics.Process]::Start($installInfo)
        $installProcess.WaitForExit()
    }

    Write-Output "DirectX 9 End-User Runtime installation completed."
}

function Main {
    # Variable to track if an error occurred
    $errorOccurred = $false

    try {
        Write-Output "Starting installation process..."

        # Create offline packages directory if it doesn't exist
        if ($PSCommandPath) {
            $offlineDir = Join-Path (Split-Path -Parent $PSCommandPath) "offline-packages"
            if (-not (Test-Path $offlineDir)) {
                Write-Verbose "Creating offline packages directory: $offlineDir"
                New-Item -ItemType Directory -Force -Path $offlineDir &gt; $null
            }

            # Check if we're running from an ISO with WinApps directory
            $isoDrives = Get-Volume | Where-Object { $_.DriveType -eq 'CD-ROM' -and $_.OperationalStatus -eq 'OK' } | Select-Object -ExpandProperty DriveLetter
            foreach ($driveLetter in $isoDrives) {
                $winAppsPath = "${driveLetter}:\WinApps"
                if (Test-Path $winAppsPath) {
                    Write-Verbose "Found WinApps directory in ISO drive ${driveLetter}"
                    break
                }
            }
        }

        Install-VCRedist
        Install-DirectX
        Write-Output "Installation process completed successfully."
    } catch {
        $errorOccurred = $true
        Write-Error "An error occurred: $_"
    } finally {
        # Wait for user input before exiting ONLY if an error occurs
        # AND if the script is started by explorer and running as administrator
        # or if the session is likely to close at the end of the script
        if ($errorOccurred -and ((Is-StartedByExplorer) -and ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) -or (Is-SessionLikelyToClose))) {
            Read-Host "Press Enter to exit"
        }
    }
}

Main -Verbose:$Verbose
Exit
		</File>
		<File path="C:\Windows\Setup\Scripts\Specialize.ps1">
$scripts = @(
	{
		reg.exe add "HKLM\SYSTEM\Setup\MoSetup" /v AllowUpgradesWithUnsupportedTPMOrCPU /t REG_DWORD /d 1 /f;
	};
	{
		reg.exe add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OOBE" /v BypassNRO /t REG_DWORD /d 1 /f;
	};
	{
		Remove-Item -LiteralPath 'Registry::HKLM\Software\Microsoft\WindowsUpdate\Orchestrator\UScheduler_Oobe\DevHomeUpdate' -Force -ErrorAction 'SilentlyContinue';
	};
	{
		Remove-Item -LiteralPath 'C:\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\OneDrive.lnk', 'C:\Windows\System32\OneDriveSetup.exe', 'C:\Windows\SysWOW64\OneDriveSetup.exe' -ErrorAction 'Continue';
	};
	{
		Remove-Item -LiteralPath 'Registry::HKLM\Software\Microsoft\WindowsUpdate\Orchestrator\UScheduler_Oobe\OutlookUpdate' -Force -ErrorAction 'SilentlyContinue';
	};
	{
		reg.exe add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Communications" /v ConfigureChatAutoInstall /t REG_DWORD /d 0 /f;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\RemovePackages.ps1' -Raw | Invoke-Expression;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\RemoveCapabilities.ps1' -Raw | Invoke-Expression;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\RemoveFeatures.ps1' -Raw | Invoke-Expression;
	};
	{
		net.exe accounts /maxpwage:UNLIMITED;
	};
	{
		reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v LongPathsEnabled /t REG_DWORD /d 1 /f
	};
	{
		icacls.exe C:\ /remove:g "*S-1-5-11"
	};
	{
		Remove-Item -LiteralPath 'C:\Users\Public\Desktop\Microsoft Edge.lnk' -ErrorAction 'SilentlyContinue' -Verbose;
	};
	{
		Set-ExecutionPolicy -Scope 'LocalMachine' -ExecutionPolicy 'RemoteSigned' -Force;
	};
	{
		fsutil.exe behavior set disableLastAccess 1;
	};
	{
		reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v AUOptions /t REG_DWORD /d 4 /f;
		reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v NoAutoRebootWithLoggedOnUsers /t REG_DWORD /d 1 /f;
	};
	{
		Register-ScheduledTask -TaskName 'MoveActiveHours' -Xml $( Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\MoveActiveHours.xml' -Raw );
	};
	{
		reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Power" /v HiberbootEnabled /t REG_DWORD /d 0 /f;
	};
	{
		reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Dsh" /v AllowNewsAndInterests /t REG_DWORD /d 0 /f;
	};
	{
		reg.exe add "HKLM\Software\Policies\Microsoft\Windows\CloudContent" /v "DisableWindowsConsumerFeatures" /t REG_DWORD /d 1 /f;
	};
	{
		reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\BitLocker" /v "PreventDeviceEncryption" /t REG_DWORD /d 1 /f;
	};
	{
		reg.exe add "HKLM\Software\Policies\Microsoft\Edge" /v HideFirstRunExperience /t REG_DWORD /d 1 /f;
	};
	{
		reg.exe add "HKLM\Software\Policies\Microsoft\Edge\Recommended" /v BackgroundModeEnabled /t REG_DWORD /d 0 /f;
		reg.exe add "HKLM\Software\Policies\Microsoft\Edge\Recommended" /v StartupBoostEnabled /t REG_DWORD /d 0 /f;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\MakeEdgeUninstallable.ps1' -Raw | Invoke-Expression;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\SetStartPins.ps1' -Raw | Invoke-Expression;
	};
	{
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ControlAnimations" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\AnimateMinMax" -Name 'DefaultValue' -Value 0 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\TaskbarAnimations" -Name 'DefaultValue' -Value 0 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\DWMAeroPeekEnabled" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\MenuAnimation" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\TooltipAnimation" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\SelectionFade" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\DWMSaveThumbnailEnabled" -Name 'DefaultValue' -Value 0 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\CursorShadow" -Name 'DefaultValue' -Value 0 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ListviewShadow" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ThumbnailsOrIcon" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ListviewAlphaSelect" -Name 'DefaultValue' -Value 0 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\DragFullWindows" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ComboBoxAnimation" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\FontSmoothing" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\ListBoxSmoothScrolling" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
		Set-ItemProperty -LiteralPath "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects\DropShadow" -Name 'DefaultValue' -Value 1 -Type 'DWord' -Force;
	};
	{
		C:\Windows\Setup\Scripts\unattend-01.cmd;
	};
	{
		reg.exe import "C:\Windows\Setup\Scripts\unattend-02.reg";
	};
);

&amp; {
  [float] $complete = 0;
  [float] $increment = 100 / $scripts.Count;
  foreach( $script in $scripts ) {
    Write-Progress -Activity 'Running scripts to customize your Windows installation. Do not close this window.' -PercentComplete $complete;
    '*** Will now execute command &#xAB;{0}&#xBB;.' -f $(
      $str = $script.ToString().Trim() -replace '\s+', ' ';
      $max = 100;
      if( $str.Length -le $max ) {
        $str;
      } else {
        $str.Substring( 0, $max - 1 ) + '&#x2026;';
      }
    );
    $start = [datetime]::Now;
    &amp; $script;
    '*** Finished executing command after {0:0} ms.' -f [datetime]::Now.Subtract( $start ).TotalMilliseconds;
    "`r`n" * 3;
    $complete += $increment;
  }
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; "C:\Windows\Setup\Scripts\Specialize.log";
		</File>
		<File path="C:\Windows\Setup\Scripts\UserOnce.ps1">
$scripts = @(
	{
		Remove-Item -LiteralPath "${env:USERPROFILE}\Desktop\Microsoft Edge.lnk" -ErrorAction 'SilentlyContinue' -Verbose;
	};
	{
		reg.exe add "HKCU\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\InprocServer32" /ve /f;
	};
	{
		Set-ItemProperty -LiteralPath 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'LaunchTo' -Type 'DWord' -Value 1;
	};
	{
		Set-ItemProperty -LiteralPath 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Search' -Name 'SearchboxTaskbarMode' -Type 'DWord' -Value 1;
	};
	{
		Set-ItemProperty -LiteralPath 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects' -Name 'VisualFXSetting' -Type 'DWord' -Value 3 -Force;
	};
	{
		New-Item -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Force;
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{5399e694-6ce5-4d6c-8fce-1d8870fdcba0}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{b4bfcc3a-db2c-424c-b029-7fe99a87c641}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{a8cdff1c-4878-43be-b5fd-f8091c1c60d0}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{374de290-123f-4565-9164-39c4925e467b}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{e88865ea-0e1c-4e20-9aa6-edcd0212c87c}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{f874310e-b6b7-47dc-bc84-b9e6b38f5903}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{1cf1260c-4dd0-4ebb-811f-33c572699fde}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{f02c1a0d-be21-4350-88b0-7367fc96ef3c}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{3add1653-eb32-4cb0-bbd7-dfa0abb5acca}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{645ff040-5081-101b-9f08-00aa002f954e}' -Value 0 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{20d04fe0-3aea-1069-a2d8-08002b30309d}' -Value 0 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{59031a47-3f72-44a7-89c5-5595fe6b30ee}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu' -Name '{a0953c92-50dc-43bf-be83-3742fed03c9c}' -Value 1 -Type 'DWord';
		New-Item -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Force;
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{5399e694-6ce5-4d6c-8fce-1d8870fdcba0}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{b4bfcc3a-db2c-424c-b029-7fe99a87c641}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{a8cdff1c-4878-43be-b5fd-f8091c1c60d0}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{374de290-123f-4565-9164-39c4925e467b}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{e88865ea-0e1c-4e20-9aa6-edcd0212c87c}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{f874310e-b6b7-47dc-bc84-b9e6b38f5903}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{1cf1260c-4dd0-4ebb-811f-33c572699fde}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{f02c1a0d-be21-4350-88b0-7367fc96ef3c}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{3add1653-eb32-4cb0-bbd7-dfa0abb5acca}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{645ff040-5081-101b-9f08-00aa002f954e}' -Value 0 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{20d04fe0-3aea-1069-a2d8-08002b30309d}' -Value 0 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{59031a47-3f72-44a7-89c5-5595fe6b30ee}' -Value 1 -Type 'DWord';
		Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel' -Name '{a0953c92-50dc-43bf-be83-3742fed03c9c}' -Value 1 -Type 'DWord';
	};
	{
		Get-Process -Name 'explorer' -ErrorAction 'SilentlyContinue' | Where-Object -FilterScript {
			$_.SessionId -eq ( Get-Process -Id $PID ).SessionId;
		} | Stop-Process -Force;
	};
);

&amp; {
  [float] $complete = 0;
  [float] $increment = 100 / $scripts.Count;
  foreach( $script in $scripts ) {
    Write-Progress -Activity 'Running scripts to configure this user account. Do not close this window.' -PercentComplete $complete;
    '*** Will now execute command &#xAB;{0}&#xBB;.' -f $(
      $str = $script.ToString().Trim() -replace '\s+', ' ';
      $max = 100;
      if( $str.Length -le $max ) {
        $str;
      } else {
        $str.Substring( 0, $max - 1 ) + '&#x2026;';
      }
    );
    $start = [datetime]::Now;
    &amp; $script;
    '*** Finished executing command after {0:0} ms.' -f [datetime]::Now.Subtract( $start ).TotalMilliseconds;
    "`r`n" * 3;
    $complete += $increment;
  }
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; "$env:TEMP\UserOnce.log";
		</File>
		<File path="C:\Windows\Setup\Scripts\DefaultUser.ps1">
$scripts = @(
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Internet Explorer\LowRegistry\Audio\PolicyConfig\PropertyStore" /f;
	};
	{
		Remove-ItemProperty -LiteralPath 'Registry::HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Run' -Name 'OneDriveSetup' -Force -ErrorAction 'Continue';
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v "HideFileExt" /t REG_DWORD /d 0 /f;
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v "Hidden" /t REG_DWORD /d 1 /f;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\ShowAllTrayIcons.ps1' -Raw | Invoke-Expression;
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowTaskViewButton /t REG_DWORD /d 0 /f;
	};
	{
		$names = @(
		  'ContentDeliveryAllowed';
		  'FeatureManagementEnabled';
		  'OEMPreInstalledAppsEnabled';
		  'PreInstalledAppsEnabled';
		  'PreInstalledAppsEverEnabled';
		  'SilentInstalledAppsEnabled';
		  'SoftLandingEnabled';
		  'SubscribedContentEnabled';
		  'SubscribedContent-310093Enabled';
		  'SubscribedContent-338387Enabled';
		  'SubscribedContent-338388Enabled';
		  'SubscribedContent-338389Enabled';
		  'SubscribedContent-338393Enabled';
		  'SubscribedContent-353694Enabled';
		  'SubscribedContent-353696Enabled';
		  'SubscribedContent-353698Enabled';
		  'SystemPaneSuggestionsEnabled';
		);

		foreach( $name in $names ) {
		  reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v $name /t REG_DWORD /d 0 /f;
		}
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v TaskbarAl /t REG_DWORD /d 0 /f;
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Policies\Microsoft\Windows\Explorer" /v DisableSearchBoxSuggestions /t REG_DWORD /d 1 /f;
	};
	{
		reg.exe add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\RunOnce" /v "UnattendedSetup" /t REG_SZ /d "powershell.exe -WindowStyle Normal -NoProfile -Command \""Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\UserOnce.ps1' -Raw | Invoke-Expression;\""" /f;
	};
);

&amp; {
  [float] $complete = 0;
  [float] $increment = 100 / $scripts.Count;
  foreach( $script in $scripts ) {
    Write-Progress -Activity 'Running scripts to modify the default user&#x2019;&#x2019;s registry hive. Do not close this window.' -PercentComplete $complete;
    '*** Will now execute command &#xAB;{0}&#xBB;.' -f $(
      $str = $script.ToString().Trim() -replace '\s+', ' ';
      $max = 100;
      if( $str.Length -le $max ) {
        $str;
      } else {
        $str.Substring( 0, $max - 1 ) + '&#x2026;';
      }
    );
    $start = [datetime]::Now;
    &amp; $script;
    '*** Finished executing command after {0:0} ms.' -f [datetime]::Now.Subtract( $start ).TotalMilliseconds;
    "`r`n" * 3;
    $complete += $increment;
  }
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; "C:\Windows\Setup\Scripts\DefaultUser.log";
		</File>
		<File path="C:\Windows\Setup\Scripts\FirstLogon.ps1">
$scripts = @(
	{
		Disable-ComputerRestore -Drive 'C:\';
	};
	{
		cmd.exe /c "rmdir C:\Windows.old";
	};
	{
		C:\Windows\Setup\Scripts\unattend-03.cmd;
	};
	{
		C:\Windows\Setup\Scripts\unattend-04.cmd;
	};
	{
		C:\Windows\Setup\Scripts\unattend-05.cmd;
	};
	{
		C:\Windows\Setup\Scripts\unattend-06.cmd;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\unattend-07.ps1' -Raw | Invoke-Expression;
	};
	{
		C:\Windows\Setup\Scripts\unattend-08.cmd;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\unattend-09.ps1' -Raw | Invoke-Expression;
	};
	{
		Get-Content -LiteralPath 'C:\Windows\Setup\Scripts\unattend-0a.ps1' -Raw | Invoke-Expression;
	};
	{
		Remove-Item -LiteralPath @(
		  'C:\Windows\Panther\unattend.xml';
		  'C:\Windows\Panther\unattend-original.xml';
		  'C:\Windows\Setup\Scripts\Wifi.xml';
		) -Force -ErrorAction 'SilentlyContinue' -Verbose;
	};
);

&amp; {
  [float] $complete = 0;
  [float] $increment = 100 / $scripts.Count;
  foreach( $script in $scripts ) {
    Write-Progress -Activity 'Running scripts to finalize your Windows installation. Do not close this window.' -PercentComplete $complete;
    '*** Will now execute command &#xAB;{0}&#xBB;.' -f $(
      $str = $script.ToString().Trim() -replace '\s+', ' ';
      $max = 100;
      if( $str.Length -le $max ) {
        $str;
      } else {
        $str.Substring( 0, $max - 1 ) + '&#x2026;';
      }
    );
    $start = [datetime]::Now;
    &amp; $script;
    '*** Finished executing command after {0:0} ms.' -f [datetime]::Now.Subtract( $start ).TotalMilliseconds;
    "`r`n" * 3;
    $complete += $increment;
  }
} *&gt;&amp;1 | Out-String -Stream &gt;&gt; "C:\Windows\Setup\Scripts\FirstLogon.log";
		</File>
	</Extensions>
</unattend>